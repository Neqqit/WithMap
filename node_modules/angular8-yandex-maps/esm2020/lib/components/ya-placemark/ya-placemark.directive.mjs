import { Directive, EventEmitter, Input, Output, } from '@angular/core';
import { Subscription } from 'rxjs';
import { EventManager } from '../../event-manager';
import * as i0 from "@angular/core";
import * as i1 from "../ya-map/ya-map.component";
/**
 * The `ya-placemark` directive wraps `ymaps.Placemark` class from the Yandex.Maps API.
 * You can configure it via the directive's inputs.
 * Events can be bound using the outputs of the directive.
 *
 * <example-url>https://stackblitz.com/edit/custom-placemark?embed=1</example-url>
 *
 * @example
 * ```html
 * <ya-map [center]="[55.751952, 37.600739]">
 *   <ya-placemark [geometry]="[55.751952, 37.600739]"></ya-placemark>
 * </ya-map>
 * ```
 */
export class YaPlacemarkDirective {
    constructor(_ngZone, _yaMapComponent) {
        this._ngZone = _ngZone;
        this._yaMapComponent = _yaMapComponent;
        this._sub = new Subscription();
        this._eventManager = new EventManager(this._ngZone);
        /**
         * Placemark instance is added in a Map.
         */
        this.ready = new EventEmitter();
        /**
         * Closing the balloon.
         */
        this.balloonclose = this._eventManager.getLazyEmitter('balloonclose');
        /**
         * Opening a balloon on a map.
         */
        this.balloonopen = this._eventManager.getLazyEmitter('balloonopen');
        /**
         * Event preceding the "drag" event.
         */
        this.beforedrag = this._eventManager.getLazyEmitter('beforedrag');
        /**
         * Event preceding the "dragstart" event.
         */
        this.beforedragstart = this._eventManager.getLazyEmitter('beforedragstart');
        /**
         * Single left-click on the object.
         */
        this.yaclick = this._eventManager.getLazyEmitter('click');
        /**
         * Calls the element's context menu.
         */
        this.yacontextmenu = this._eventManager.getLazyEmitter('contextmenu');
        /**
         * Double left-click on the object.
         */
        this.yadblclick = this._eventManager.getLazyEmitter('dblclick');
        /**
         * Dragging a geo object.
         */
        this.yadrag = this._eventManager.getLazyEmitter('drag');
        /**
         * End of geo object dragging.
         */
        this.yadragend = this._eventManager.getLazyEmitter('dragend');
        /**
         * Start of geo object dragging.
         */
        this.yadragstart = this._eventManager.getLazyEmitter('dragstart');
        /**
         * Change in the state of the editor for the geo object's geometry.
         */
        this.editorstatechange = this._eventManager.getLazyEmitter('editorstatechange');
        /**
         * Change to the geo object geometry
         */
        this.geometrychange = this._eventManager.getLazyEmitter('geometrychange');
        /**
         * Closing the hint.
         */
        this.hintclose = this._eventManager.getLazyEmitter('hintclose');
        /**
         * Opening a hint on a map.
         */
        this.hintopen = this._eventManager.getLazyEmitter('hintopen');
        /**
         * Map reference changed.
         */
        this.mapchange = this._eventManager.getLazyEmitter('mapchange');
        /**
         * Pressing the mouse button over the object.
         */
        this.yamousedown = this._eventManager.getLazyEmitter('mousedown');
        /**
         * Pointing the cursor at the object.
         */
        this.yamouseenter = this._eventManager.getLazyEmitter('mouseenter');
        /**
         * Moving the cursor off of the object.
         */
        this.yamouseleave = this._eventManager.getLazyEmitter('mouseleave');
        /**
         * Moving the cursor over the object.
         */
        this.yamousemove = this._eventManager.getLazyEmitter('mousemove');
        /**
         * Letting go of the mouse button over an object.
         */
        this.yamouseup = this._eventManager.getLazyEmitter('mouseup');
        /**
         * End of multitouch.
         */
        this.multitouchend = this._eventManager.getLazyEmitter('multitouchend');
        /**
         * Repeating event during multitouch.
         */
        this.multitouchmove = this._eventManager.getLazyEmitter('multitouchmove');
        /**
         * Start of multitouch.
         */
        this.multitouchstart = this._eventManager.getLazyEmitter('multitouchstart');
        /**
         * Change to the object options.
         */
        this.optionschange = this._eventManager.getLazyEmitter('optionschange');
        /**
         * Change to the geo object overlay.
         */
        this.overlaychange = this._eventManager.getLazyEmitter('overlaychange');
        /**
         * The parent object reference changed.
         */
        this.parentchange = this._eventManager.getLazyEmitter('parentchange');
        /**
         * Change to the geo object data.
         */
        this.propertieschange = this._eventManager.getLazyEmitter('propertieschange');
        /**
         * Mouse wheel scrolling.
         */
        this.yawheel = this._eventManager.getLazyEmitter('wheel');
    }
    /**
     * Handles input changes and passes them in API.
     * @param changes
     */
    ngOnChanges(changes) {
        const { placemark } = this;
        if (placemark) {
            const { geometry, properties, options } = changes;
            if (geometry) {
                placemark.geometry?.setCoordinates(geometry.currentValue);
            }
            if (properties) {
                placemark.properties.set(properties.currentValue);
            }
            if (options) {
                placemark.options.set(options.currentValue);
            }
        }
    }
    ngOnInit() {
        if (this._yaMapComponent.isBrowser) {
            const sub = this._yaMapComponent.map$.subscribe((map) => {
                if (map) {
                    const placemark = this._createPlacemark();
                    this.placemark = placemark;
                    map.geoObjects.add(placemark);
                    this._eventManager.setTarget(placemark);
                    this._ngZone.run(() => this.ready.emit({ ymaps, target: placemark }));
                }
            });
            this._sub.add(sub);
        }
    }
    ngOnDestroy() {
        if (this.placemark) {
            this._yaMapComponent?.map$.value?.geoObjects.remove(this.placemark);
            this._eventManager.destroy();
        }
        this._sub.unsubscribe();
    }
    /**
     * Creates a placemark.
     */
    _createPlacemark() {
        return new ymaps.Placemark(this.geometry, this.properties, this.options);
    }
}
YaPlacemarkDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.0.2", ngImport: i0, type: YaPlacemarkDirective, deps: [{ token: i0.NgZone }, { token: i1.YaMapComponent }], target: i0.ɵɵFactoryTarget.Directive });
YaPlacemarkDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "13.0.2", type: YaPlacemarkDirective, selector: "ya-placemark", inputs: { geometry: "geometry", properties: "properties", options: "options" }, outputs: { ready: "ready", balloonclose: "balloonclose", balloonopen: "balloonopen", beforedrag: "beforedrag", beforedragstart: "beforedragstart", yaclick: "yaclick", yacontextmenu: "yacontextmenu", yadblclick: "yadblclick", yadrag: "yadrag", yadragend: "yadragend", yadragstart: "yadragstart", editorstatechange: "editorstatechange", geometrychange: "geometrychange", hintclose: "hintclose", hintopen: "hintopen", mapchange: "mapchange", yamousedown: "yamousedown", yamouseenter: "yamouseenter", yamouseleave: "yamouseleave", yamousemove: "yamousemove", yamouseup: "yamouseup", multitouchend: "multitouchend", multitouchmove: "multitouchmove", multitouchstart: "multitouchstart", optionschange: "optionschange", overlaychange: "overlaychange", parentchange: "parentchange", propertieschange: "propertieschange", yawheel: "yawheel" }, usesOnChanges: true, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.0.2", ngImport: i0, type: YaPlacemarkDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: 'ya-placemark',
                }]
        }], ctorParameters: function () { return [{ type: i0.NgZone }, { type: i1.YaMapComponent }]; }, propDecorators: { geometry: [{
                type: Input
            }], properties: [{
                type: Input
            }], options: [{
                type: Input
            }], ready: [{
                type: Output
            }], balloonclose: [{
                type: Output
            }], balloonopen: [{
                type: Output
            }], beforedrag: [{
                type: Output
            }], beforedragstart: [{
                type: Output
            }], yaclick: [{
                type: Output
            }], yacontextmenu: [{
                type: Output
            }], yadblclick: [{
                type: Output
            }], yadrag: [{
                type: Output
            }], yadragend: [{
                type: Output
            }], yadragstart: [{
                type: Output
            }], editorstatechange: [{
                type: Output
            }], geometrychange: [{
                type: Output
            }], hintclose: [{
                type: Output
            }], hintopen: [{
                type: Output
            }], mapchange: [{
                type: Output
            }], yamousedown: [{
                type: Output
            }], yamouseenter: [{
                type: Output
            }], yamouseleave: [{
                type: Output
            }], yamousemove: [{
                type: Output
            }], yamouseup: [{
                type: Output
            }], multitouchend: [{
                type: Output
            }], multitouchmove: [{
                type: Output
            }], multitouchstart: [{
                type: Output
            }], optionschange: [{
                type: Output
            }], overlaychange: [{
                type: Output
            }], parentchange: [{
                type: Output
            }], propertieschange: [{
                type: Output
            }], yawheel: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoieWEtcGxhY2VtYXJrLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2FuZ3VsYXI4LXlhbmRleC1tYXBzL3NyYy9saWIvY29tcG9uZW50cy95YS1wbGFjZW1hcmsveWEtcGxhY2VtYXJrLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULFlBQVksRUFDWixLQUFLLEVBS0wsTUFBTSxHQUVQLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBYyxZQUFZLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFaEQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLHFCQUFxQixDQUFDOzs7QUFJbkQ7Ozs7Ozs7Ozs7Ozs7R0FhRztBQUlILE1BQU0sT0FBTyxvQkFBb0I7SUF3TS9CLFlBQTZCLE9BQWUsRUFBbUIsZUFBK0I7UUFBakUsWUFBTyxHQUFQLE9BQU8sQ0FBUTtRQUFtQixvQkFBZSxHQUFmLGVBQWUsQ0FBZ0I7UUF2TTdFLFNBQUksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBRTFCLGtCQUFhLEdBQUcsSUFBSSxZQUFZLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBc0JoRTs7V0FFRztRQUNPLFVBQUssR0FBZ0QsSUFBSSxZQUFZLEVBRTVFLENBQUM7UUFFSjs7V0FFRztRQUNPLGlCQUFZLEdBQ3BCLElBQUksQ0FBQyxhQUFhLENBQUMsY0FBYyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBRXBEOztXQUVHO1FBQ08sZ0JBQVcsR0FDbkIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxjQUFjLENBQUMsYUFBYSxDQUFDLENBQUM7UUFFbkQ7O1dBRUc7UUFDTyxlQUFVLEdBQ2xCLElBQUksQ0FBQyxhQUFhLENBQUMsY0FBYyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBRWxEOztXQUVHO1FBQ08sb0JBQWUsR0FDdkIsSUFBSSxDQUFDLGFBQWEs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QWlCO3NCQUExQixNQUFNO2dCQU1HLGNBQWM7c0JBQXZCLE1BQU07Z0JBTUcsU0FBUztzQkFBbEIsTUFBTTtnQkFNRyxRQUFRO3NCQUFqQixNQUFNO2dCQU1HLFNBQVM7c0JBQWxCLE1BQU07Z0JBTUcsV0FBVztzQkFBcEIsTUFBTTtnQkFNRyxZQUFZO3NCQUFyQixNQUFNO2dCQU1HLFlBQVk7c0JBQXJCLE1BQU07Z0JBTUcsV0FBVztzQkFBcEIsTUFBTTtnQkFNRyxTQUFTO3NCQUFsQixNQUFNO2dCQU1HLGFBQWE7c0JBQXRCLE1BQU07Z0JBTUcsY0FBYztzQkFBdkIsTUFBTTtnQkFNRyxlQUFlO3NCQUF4QixNQUFNO2dCQU1HLGFBQWE7c0JBQXRCLE1BQU07Z0JBTUcsYUFBYTtzQkFBdEIsTUFBTTtnQkFNRyxZQUFZO3NCQUFyQixNQUFNO2dCQU1HLGdCQUFnQjtzQkFBekIsTUFBTTtnQkFNRyxPQUFPO3NCQUFoQixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgRGlyZWN0aXZlLFxuICBFdmVudEVtaXR0ZXIsXG4gIElucHV0LFxuICBOZ1pvbmUsXG4gIE9uQ2hhbmdlcyxcbiAgT25EZXN0cm95LFxuICBPbkluaXQsXG4gIE91dHB1dCxcbiAgU2ltcGxlQ2hhbmdlcyxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IFlhTWFwQ29tcG9uZW50IH0gZnJvbSAnLi4veWEtbWFwL3lhLW1hcC5jb21wb25lbnQnO1xuaW1wb3J0IHsgRXZlbnRNYW5hZ2VyIH0gZnJvbSAnLi4vLi4vZXZlbnQtbWFuYWdlcic7XG5pbXBvcnQgeyBZYVJlYWR5RXZlbnQgfSBmcm9tICcuLi8uLi90eXBpbmdzL3lhLXJlYWR5LWV2ZW50JztcbmltcG9ydCB7IFlhRXZlbnQgfSBmcm9tICcuLi8uLi90eXBpbmdzL3lhLWV2ZW50JztcblxuLyoqXG4gKiBUaGUgYHlhLXBsYWNlbWFya2AgZGlyZWN0aXZlIHdyYXBzIGB5bWFwcy5QbGFjZW1hcmtgIGNsYXNzIGZyb20gdGhlIFlhbmRleC5NYXBzIEFQSS5cbiAqIFlvdSBjYW4gY29uZmlndXJlIGl0IHZpYSB0aGUgZGlyZWN0aXZlJ3MgaW5wdXRzLlxuICogRXZlbnRzIGNhbiBiZSBib3VuZCB1c2luZyB0aGUgb3V0cHV0cyBvZiB0aGUgZGlyZWN0aXZlLlxuICpcbiAqIDxleGFtcGxlLXVybD5odHRwczovL3N0YWNrYmxpdHouY29tL2VkaXQvY3VzdG9tLXBsYWNlbWFyaz9lbWJlZD0xPC9leGFtcGxlLXVybD5cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgaHRtbFxuICogPHlhLW1hcCBbY2VudGVyXT1cIls1NS43NTE5NTIsIDM3LjYwMDczOV1cIj5cbiAqICAgPHlhLXBsYWNlbWFyayBbZ2VvbWV0cnldPVwiWzU1Ljc1MTk1MiwgMzcuNjAwNzM5XVwiPjwveWEtcGxhY2VtYXJrPlxuICogPC95YS1tYXA+XG4gKiBgYGBcbiAqL1xuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAneWEtcGxhY2VtYXJrJyxcbn0pXG5leHBvcnQgY2xhc3MgWWFQbGFjZW1hcmtEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgT25EZXN0cm95IHtcbiAgcHJpdmF0ZSByZWFkb25seSBfc3ViID0gbmV3IFN1YnNjcmlwdGlvbigpO1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgX2V2ZW50TWFuYWdlciA9IG5ldyBFdmVudE1hbmFnZXIodGhpcy5fbmdab25lKTtcblxuICBwbGFjZW1hcms/OiB5bWFwcy5QbGFjZW1hcms7XG5cbiAgLyoqXG4gICAqIENvb3JkaW5hdGVzIG9mIHRoZSBwbGFjZW1hcmssIG9yIGEgaGFzaCBkZXNjcmliaW5nIHRoZSBnZW9tZXRyeSwgb3IgYSByZWZlcmVuY2UgdG8gdGhlIHBvaW50IGdlb21ldHJ5IG9iamVjdC5cbiAgICoge0BsaW5rIGh0dHBzOi8veWFuZGV4LmNvbS9kZXYvbWFwcy9qc2FwaS9kb2MvMi4xL3JlZi9yZWZlcmVuY2UvUGxhY2VtYXJrLmh0bWwjUGxhY2VtYXJrX19wYXJhbS1nZW9tZXRyeX1cbiAgICovXG4gIEBJbnB1dCgpIGdlb21ldHJ5OiBudW1iZXJbXSB8IG9iamVjdCB8IHltYXBzLklQb2ludEdlb21ldHJ5O1xuXG4gIC8qKlxuICAgKiBQcm9wZXJ0aWVzIGZvciB0aGUgcGxhY2VtYXJrLlxuICAgKiB7QGxpbmsgaHR0cHM6Ly95YW5kZXguY29tL21hcHMvanNhcGkvZG9jLzIuMS9yZWYvcmVmZXJlbmNlL1BsYWNlbWFyay1kb2NwYWdlLyNQbGFjZW1hcmtwYXJhbS1wcm9wZXJ0aWVzfVxuICAgKi9cbiAgQElucHV0KCkgcHJvcGVydGllczogeW1hcHMuSVBsYWNlbWFya1Byb3BlcnRpZXMgfCB5bWFwcy5JRGF0YU1hbmFnZXI7XG5cbiAgLyoqXG4gICAqIE9wdGlvbnMgZm9yIHRoZSBwbGFjZW1hcmsuXG4gICAqIHtAbGluayBodHRwczovL3lhbmRleC5jb20vbWFwcy9qc2FwaS9kb2MvMi4xL3JlZi9yZWZlcmVuY2UvUGxhY2VtYXJrLWRvY3BhZ2UvI1BsYWNlbWFya3BhcmFtLW9wdGlvbnN9XG4gICAqL1xuICBASW5wdXQoKSBvcHRpb25zOiB5bWFwcy5JUGxhY2VtYXJrT3B0aW9ucztcblxuICAvKipcbiAgICogUGxhY2VtYXJrIGluc3RhbmNlIGlzIGFkZGVkIGluIGEgTWFwLlxuICAgKi9cbiAgQE91dHB1dCgpIHJlYWR5OiBFdmVudEVtaXR0ZXI8WWFSZWFkeUV2ZW50PHltYXBzLlBsYWNlbWFyaz4+ID0gbmV3IEV2ZW50RW1pdHRlcjxcbiAgICBZYVJlYWR5RXZlbnQ8eW1hcHMuUGxhY2VtYXJrPlxuICA+KCk7XG5cbiAgLyoqXG4gICAqIENsb3NpbmcgdGhlIGJhbGxvb24uXG4gICAqL1xuICBAT3V0cHV0KCkgYmFsbG9vbmNsb3NlOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuUGxhY2VtYXJrPj4gPVxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignYmFsbG9vbmNsb3NlJyk7XG5cbiAgLyoqXG4gICAqIE9wZW5pbmcgYSBiYWxsb29uIG9uIGEgbWFwLlxuICAgKi9cbiAgQE91dHB1dCgpIGJhbGxvb25vcGVuOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuUGxhY2VtYXJrPj4gPVxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignYmFsbG9vbm9wZW4nKTtcblxuICAvKipcbiAgICogRXZlbnQgcHJlY2VkaW5nIHRoZSBcImRyYWdcIiBldmVudC5cbiAgICovXG4gIEBPdXRwdXQoKSBiZWZvcmVkcmFnOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuUGxhY2VtYXJrPj4gPVxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignYmVmb3JlZHJhZycpO1xuXG4gIC8qKlxuICAgKiBFdmVudCBwcmVjZWRpbmcgdGhlIFwiZHJhZ3N0YXJ0XCIgZXZlbnQuXG4gICAqL1xuICBAT3V0cHV0KCkgYmVmb3JlZHJhZ3N0YXJ0OiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuUGxhY2VtYXJrPj4gPVxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignYmVmb3JlZHJhZ3N0YXJ0Jyk7XG5cbiAgLyoqXG4gICAqIFNpbmdsZSBsZWZ0LWNsaWNrIG9uIHRoZSBvYmplY3QuXG4gICAqL1xuICBAT3V0cHV0KCkgeWFjbGljazogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLlBsYWNlbWFyaz4+ID1cbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ2NsaWNrJyk7XG5cbiAgLyoqXG4gICAqIENhbGxzIHRoZSBlbGVtZW50J3MgY29udGV4dCBtZW51LlxuICAgKi9cbiAgQE91dHB1dCgpIHlhY29udGV4dG1lbnU6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5QbGFjZW1hcms+PiA9XG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdjb250ZXh0bWVudScpO1xuXG4gIC8qKlxuICAgKiBEb3VibGUgbGVmdC1jbGljayBvbiB0aGUgb2JqZWN0LlxuICAgKi9cbiAgQE91dHB1dCgpIHlhZGJsY2xpY2s6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5QbGFjZW1hcms+PiA9XG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdkYmxjbGljaycpO1xuXG4gIC8qKlxuICAgKiBEcmFnZ2luZyBhIGdlbyBvYmplY3QuXG4gICAqL1xuICBAT3V0cHV0KCkgeWFkcmFnOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuUGxhY2VtYXJrPj4gPVxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignZHJhZycpO1xuXG4gIC8qKlxuICAgKiBFbmQgb2YgZ2VvIG9iamVjdCBkcmFnZ2luZy5cbiAgICovXG4gIEBPdXRwdXQoKSB5YWRyYWdlbmQ6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5QbGFjZW1hcms+PiA9XG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdkcmFnZW5kJyk7XG5cbiAgLyoqXG4gICAqIFN0YXJ0IG9mIGdlbyBvYmplY3QgZHJhZ2dpbmcuXG4gICAqL1xuICBAT3V0cHV0KCkgeWFkcmFnc3RhcnQ6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5QbGFjZW1hcms+PiA9XG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdkcmFnc3RhcnQnKTtcblxuICAvKipcbiAgICogQ2hhbmdlIGluIHRoZSBzdGF0ZSBvZiB0aGUgZWRpdG9yIGZvciB0aGUgZ2VvIG9iamVjdCdzIGdlb21ldHJ5LlxuICAgKi9cbiAgQE91dHB1dCgpIGVkaXRvcnN0YXRlY2hhbmdlOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuUGxhY2VtYXJrPj4gPVxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignZWRpdG9yc3RhdGVjaGFuZ2UnKTtcblxuICAvKipcbiAgICogQ2hhbmdlIHRvIHRoZSBnZW8gb2JqZWN0IGdlb21ldHJ5XG4gICAqL1xuICBAT3V0cHV0KCkgZ2VvbWV0cnljaGFuZ2U6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5QbGFjZW1hcms+PiA9XG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdnZW9tZXRyeWNoYW5nZScpO1xuXG4gIC8qKlxuICAgKiBDbG9zaW5nIHRoZSBoaW50LlxuICAgKi9cbiAgQE91dHB1dCgpIGhpbnRjbG9zZTogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLlBsYWNlbWFyaz4+ID1cbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ2hpbnRjbG9zZScpO1xuXG4gIC8qKlxuICAgKiBPcGVuaW5nIGEgaGludCBvbiBhIG1hcC5cbiAgICovXG4gIEBPdXRwdXQoKSBoaW50b3BlbjogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLlBsYWNlbWFyaz4+ID1cbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ2hpbnRvcGVuJyk7XG5cbiAgLyoqXG4gICAqIE1hcCByZWZlcmVuY2UgY2hhbmdlZC5cbiAgICovXG4gIEBPdXRwdXQoKSBtYXBjaGFuZ2U6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5QbGFjZW1hcms+PiA9XG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdtYXBjaGFuZ2UnKTtcblxuICAvKipcbiAgICogUHJlc3NpbmcgdGhlIG1vdXNlIGJ1dHRvbiBvdmVyIHRoZSBvYmplY3QuXG4gICAqL1xuICBAT3V0cHV0KCkgeWFtb3VzZWRvd246IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5QbGFjZW1hcms+PiA9XG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdtb3VzZWRvd24nKTtcblxuICAvKipcbiAgICogUG9pbnRpbmcgdGhlIGN1cnNvciBhdCB0aGUgb2JqZWN0LlxuICAgKi9cbiAgQE91dHB1dCgpIHlhbW91c2VlbnRlcjogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLlBsYWNlbWFyaz4+ID1cbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ21vdXNlZW50ZXInKTtcblxuICAvKipcbiAgICogTW92aW5nIHRoZSBjdXJzb3Igb2ZmIG9mIHRoZSBvYmplY3QuXG4gICAqL1xuICBAT3V0cHV0KCkgeWFtb3VzZWxlYXZlOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuUGxhY2VtYXJrPj4gPVxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignbW91c2VsZWF2ZScpO1xuXG4gIC8qKlxuICAgKiBNb3ZpbmcgdGhlIGN1cnNvciBvdmVyIHRoZSBvYmplY3QuXG4gICAqL1xuICBAT3V0cHV0KCkgeWFtb3VzZW1vdmU6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5QbGFjZW1hcms+PiA9XG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdtb3VzZW1vdmUnKTtcblxuICAvKipcbiAgICogTGV0dGluZyBnbyBvZiB0aGUgbW91c2UgYnV0dG9uIG92ZXIgYW4gb2JqZWN0LlxuICAgKi9cbiAgQE91dHB1dCgpIHlhbW91c2V1cDogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLlBsYWNlbWFyaz4+ID1cbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ21vdXNldXAnKTtcblxuICAvKipcbiAgICogRW5kIG9mIG11bHRpdG91Y2guXG4gICAqL1xuICBAT3V0cHV0KCkgbXVsdGl0b3VjaGVuZDogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLlBsYWNlbWFyaz4+ID1cbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ211bHRpdG91Y2hlbmQnKTtcblxuICAvKipcbiAgICogUmVwZWF0aW5nIGV2ZW50IGR1cmluZyBtdWx0aXRvdWNoLlxuICAgKi9cbiAgQE91dHB1dCgpIG11bHRpdG91Y2htb3ZlOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuUGxhY2VtYXJrPj4gPVxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignbXVsdGl0b3VjaG1vdmUnKTtcblxuICAvKipcbiAgICogU3RhcnQgb2YgbXVsdGl0b3VjaC5cbiAgICovXG4gIEBPdXRwdXQoKSBtdWx0aXRvdWNoc3RhcnQ6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5QbGFjZW1hcms+PiA9XG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdtdWx0aXRvdWNoc3RhcnQnKTtcblxuICAvKipcbiAgICogQ2hhbmdlIHRvIHRoZSBvYmplY3Qgb3B0aW9ucy5cbiAgICovXG4gIEBPdXRwdXQoKSBvcHRpb25zY2hhbmdlOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuUGxhY2VtYXJrPj4gPVxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignb3B0aW9uc2NoYW5nZScpO1xuXG4gIC8qKlxuICAgKiBDaGFuZ2UgdG8gdGhlIGdlbyBvYmplY3Qgb3ZlcmxheS5cbiAgICovXG4gIEBPdXRwdXQoKSBvdmVybGF5Y2hhbmdlOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuUGxhY2VtYXJrPj4gPVxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignb3ZlcmxheWNoYW5nZScpO1xuXG4gIC8qKlxuICAgKiBUaGUgcGFyZW50IG9iamVjdCByZWZlcmVuY2UgY2hhbmdlZC5cbiAgICovXG4gIEBPdXRwdXQoKSBwYXJlbnRjaGFuZ2U6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5QbGFjZW1hcms+PiA9XG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdwYXJlbnRjaGFuZ2UnKTtcblxuICAvKipcbiAgICogQ2hhbmdlIHRvIHRoZSBnZW8gb2JqZWN0IGRhdGEuXG4gICAqL1xuICBAT3V0cHV0KCkgcHJvcGVydGllc2NoYW5nZTogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLlBsYWNlbWFyaz4+ID1cbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ3Byb3BlcnRpZXNjaGFuZ2UnKTtcblxuICAvKipcbiAgICogTW91c2Ugd2hlZWwgc2Nyb2xsaW5nLlxuICAgKi9cbiAgQE91dHB1dCgpIHlhd2hlZWw6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5QbGFjZW1hcms+PiA9XG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCd3aGVlbCcpO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgX25nWm9uZTogTmdab25lLCBwcml2YXRlIHJlYWRvbmx5IF95YU1hcENvbXBvbmVudDogWWFNYXBDb21wb25lbnQpIHt9XG5cbiAgLyoqXG4gICAqIEhhbmRsZXMgaW5wdXQgY2hhbmdlcyBhbmQgcGFzc2VzIHRoZW0gaW4gQVBJLlxuICAgKiBAcGFyYW0gY2hhbmdlc1xuICAgKi9cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICAgIGNvbnN0IHsgcGxhY2VtYXJrIH0gPSB0aGlzO1xuXG4gICAgaWYgKHBsYWNlbWFyaykge1xuICAgICAgY29uc3QgeyBnZW9tZXRyeSwgcHJvcGVydGllcywgb3B0aW9ucyB9ID0gY2hhbmdlcztcblxuICAgICAgaWYgKGdlb21ldHJ5KSB7XG4gICAgICAgIHBsYWNlbWFyay5nZW9tZXRyeT8uc2V0Q29vcmRpbmF0ZXMoZ2VvbWV0cnkuY3VycmVudFZhbHVlKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHByb3BlcnRpZXMpIHtcbiAgICAgICAgcGxhY2VtYXJrLnByb3BlcnRpZXMuc2V0KHByb3BlcnRpZXMuY3VycmVudFZhbHVlKTtcbiAgICAgIH1cblxuICAgICAgaWYgKG9wdGlvbnMpIHtcbiAgICAgICAgcGxhY2VtYXJrLm9wdGlvbnMuc2V0KG9wdGlvbnMuY3VycmVudFZhbHVlKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5feWFNYXBDb21wb25lbnQuaXNCcm93c2VyKSB7XG4gICAgICBjb25zdCBzdWIgPSB0aGlzLl95YU1hcENvbXBvbmVudC5tYXAkLnN1YnNjcmliZSgobWFwKSA9PiB7XG4gICAgICAgIGlmIChtYXApIHtcbiAgICAgICAgICBjb25zdCBwbGFjZW1hcmsgPSB0aGlzLl9jcmVhdGVQbGFjZW1hcmsoKTtcbiAgICAgICAgICB0aGlzLnBsYWNlbWFyayA9IHBsYWNlbWFyaztcblxuICAgICAgICAgIG1hcC5nZW9PYmplY3RzLmFkZChwbGFjZW1hcmspO1xuICAgICAgICAgIHRoaXMuX2V2ZW50TWFuYWdlci5zZXRUYXJnZXQocGxhY2VtYXJrKTtcbiAgICAgICAgICB0aGlzLl9uZ1pvbmUucnVuKCgpID0+IHRoaXMucmVhZHkuZW1pdCh7IHltYXBzLCB0YXJnZXQ6IHBsYWNlbWFyayB9KSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLl9zdWIuYWRkKHN1Yik7XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgaWYgKHRoaXMucGxhY2VtYXJrKSB7XG4gICAgICB0aGlzLl95YU1hcENvbXBvbmVudD8ubWFwJC52YWx1ZT8uZ2VvT2JqZWN0cy5yZW1vdmUodGhpcy5wbGFjZW1hcmspO1xuICAgICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmRlc3Ryb3koKTtcbiAgICB9XG5cbiAgICB0aGlzLl9zdWIudW5zdWJzY3JpYmUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgcGxhY2VtYXJrLlxuICAgKi9cbiAgcHJpdmF0ZSBfY3JlYXRlUGxhY2VtYXJrKCk6IHltYXBzLlBsYWNlbWFyayB7XG4gICAgcmV0dXJuIG5ldyB5bWFwcy5QbGFjZW1hcmsodGhpcy5nZW9tZXRyeSwgdGhpcy5wcm9wZXJ0aWVzLCB0aGlzLm9wdGlvbnMpO1xuICB9XG59XG4iXX0=