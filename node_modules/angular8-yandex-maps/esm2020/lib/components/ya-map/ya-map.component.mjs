import { ChangeDetectionStrategy, Component, EventEmitter, Inject, Input, Output, PLATFORM_ID, ViewChild, } from '@angular/core';
import { isPlatformBrowser } from '@angular/common';
import { BehaviorSubject, Subscription } from 'rxjs';
import { EventManager } from '../../event-manager';
import { generateRandomId } from '../../utils/generate-random-id';
import * as i0 from "@angular/core";
import * as i1 from "../../services/ya-api-loader/ya-api-loader.service";
/**
 * The `ya-map` component wraps `ymaps.Map` class from the Yandex.Maps API.
 * You can configure the map via the component's inputs.
 * Events can be bound using the outputs of the component.
 *
 * <example-url>https://stackblitz.com/edit/map-onload-event?embed=1</example-url>
 *
 * @example
 * ```html
 * <ya-map
 *   [center]="[55.751952, 37.600739]"
 *   [state]="{type: 'yandex#satellite'}"
 * ></ya-map>
 * ```
 */
export class YaMapComponent {
    constructor(_ngZone, _yaApiLoaderService, 
    /*
     * We need to use the same type like in an Angular.
     * "export declare const PLATFORM_ID: InjectionToken<Object>"
     */
    // eslint-disable-next-line @typescript-eslint/ban-types
    platformId) {
        this._ngZone = _ngZone;
        this._yaApiLoaderService = _yaApiLoaderService;
        this._sub = new Subscription();
        this._eventManager = new EventManager(this._ngZone);
        this.map$ = new BehaviorSubject(undefined);
        /**
         * Map instance is created.
         */
        this.ready = new EventEmitter();
        /**
         * The start of a new smooth map movement.
         */
        this.actionbegin = this._eventManager.getLazyEmitter('actionbegin');
        /**
         * Event that occurs when an action step was prematurely stopped.
         */
        this.actionbreak = this._eventManager.getLazyEmitter('actionbreak');
        /**
         * The end of smooth map movement.
         */
        this.actionend = this._eventManager.getLazyEmitter('actionend');
        /**
         * The start of a new step of smooth movement.
         */
        this.actiontick = this._eventManager.getLazyEmitter('actiontick');
        /**
         * The end of performing a step of smooth movement.
         */
        this.actiontickcomplete = this._eventManager.getLazyEmitter('actiontickcomplete');
        /**
         * Closing the balloon.
         */
        this.balloonclose = this._eventManager.getLazyEmitter('balloonclose');
        /**
         * Opening a balloon on a map.
         */
        this.balloonopen = this._eventManager.getLazyEmitter('balloonopen');
        /**
         * Event for a change to the map viewport.
         */
        this.boundschange = this._eventManager.getLazyEmitter('boundschange');
        /**
         * Single left-click on the object.
         */
        this.yaclick = this._eventManager.getLazyEmitter('click');
        /**
         * Calls the element's context menu.
         */
        this.yacontextmenu = this._eventManager.getLazyEmitter('contextmenu');
        /**
         * Double left-click on the object.
         */
        this.yadblclick = this._eventManager.getLazyEmitter('dblclick');
        /**
         * The map was destroyed.
         */
        this.destroy = this._eventManager.getLazyEmitter('destroy');
        /**
         * Closing the hint.
         */
        this.hintclose = this._eventManager.getLazyEmitter('hintclose');
        /**
         * Opening a hint on a map.
         */
        this.hintopen = this._eventManager.getLazyEmitter('hintopen');
        /**
         * Map margins changed.
         */
        this.marginchange = this._eventManager.getLazyEmitter('marginchange');
        /**
         * Pressing the mouse button over the object.
         */
        this.yamousedown = this._eventManager.getLazyEmitter('mousedown');
        /**
         * Pointing the cursor at the object.
         */
        this.yamouseenter = this._eventManager.getLazyEmitter('mouseenter');
        /**
         * Moving the cursor off of the object.
         */
        this.yamouseleave = this._eventManager.getLazyEmitter('mouseleave');
        /**
         * Moving the cursor over the object.
         */
        this.yamousemove = this._eventManager.getLazyEmitter('mousemove');
        /**
         * Letting go of the mouse button over an object.
         */
        this.yamouseup = this._eventManager.getLazyEmitter('mouseup');
        /**
         * End of multitouch.
         */
        this.multitouchend = this._eventManager.getLazyEmitter('multitouchend');
        /**
         * Repeating event during multitouch.
         */
        this.multitouchmove = this._eventManager.getLazyEmitter('multitouchmove');
        /**
         * Start of multitouch.
         */
        this.multitouchstart = this._eventManager.getLazyEmitter('multitouchstart');
        /**
         * Map options changed.
         */
        this.optionschange = this._eventManager.getLazyEmitter('optionschange');
        /**
         * Map size changed.
         */
        this.sizechange = this._eventManager.getLazyEmitter('sizechange');
        /**
         * The map type changed.
         */
        this.typechange = this._eventManager.getLazyEmitter('typechange');
        /**
         * Mouse wheel scrolling.
         */
        this.yawheel = this._eventManager.getLazyEmitter('wheel');
        this.isBrowser = isPlatformBrowser(platformId);
    }
    /**
     * Handles input changes and passes them in API.
     * @param changes
     */
    ngOnChanges(changes) {
        const map = this.map$.value;
        if (map) {
            const { center, zoom, state, options } = changes;
            if (state) {
                this._setState(this._combineState(), map);
            }
            if (center) {
                map.setCenter(center.currentValue);
            }
            if (zoom) {
                map.setZoom(zoom.currentValue);
            }
            if (options) {
                map.options.set(options.currentValue);
            }
        }
    }
    ngAfterViewInit() {
        /**
         * It should be a noop during server-side rendering.
         */
        if (this.isBrowser) {
            const sub = this._yaApiLoaderService.load().subscribe(() => {
                const id = generateRandomId();
                const map = this._createMap(id);
                this.map$.next(map);
                this._eventManager.setTarget(map);
                this._ngZone.run(() => this.ready.emit({ ymaps, target: map }));
            });
            this._sub.add(sub);
        }
    }
    ngOnDestroy() {
        this._eventManager.destroy();
        this._sub.unsubscribe();
    }
    /**
     * Destructs state and passes it in API.
     * @param state
     * @param map
     */
    _setState(state, map) {
        const { behaviors, bounds, center, controls, margin, type, zoom } = state;
        if (behaviors) {
            map.behaviors.enable(behaviors);
        }
        if (bounds) {
            map.setBounds(bounds);
        }
        if (center) {
            map.setCenter(center);
        }
        if (controls) {
            controls.forEach((control) => map.controls.add(control));
        }
        if (margin) {
            map.margin.setDefaultMargin(margin);
        }
        if (type) {
            map.setType(type);
        }
        if (zoom) {
            map.setZoom(zoom);
        }
    }
    /**
     * Creates a map.
     * @param id ID which will be set to the map container.
     */
    _createMap(id) {
        const containerElem = this.container.nativeElement;
        containerElem.setAttribute('id', id);
        containerElem.style.cssText = 'width: 100%; height: 100%;';
        return new ymaps.Map(id, this._combineState(), this.options || {});
    }
    /**
     * Combines the center and zoom into single object.
     */
    _combineState() {
        const state = this.state || {};
        return {
            ...state,
            center: this.center || state.center || [0, 0],
            zoom: this.zoom ?? state.zoom ?? 10,
        };
    }
}
YaMapComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.0.2", ngImport: i0, type: YaMapComponent, deps: [{ token: i0.NgZone }, { token: i1.YaApiLoaderService }, { token: PLATFORM_ID }], target: i0.ɵɵFactoryTarget.Component });
YaMapComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.0.2", type: YaMapComponent, selector: "ya-map", inputs: { center: "center", zoom: "zoom", state: "state", options: "options" }, outputs: { ready: "ready", actionbegin: "actionbegin", actionbreak: "actionbreak", actionend: "actionend", actiontick: "actiontick", actiontickcomplete: "actiontickcomplete", balloonclose: "balloonclose", balloonopen: "balloonopen", boundschange: "boundschange", yaclick: "yaclick", yacontextmenu: "yacontextmenu", yadblclick: "yadblclick", destroy: "destroy", hintclose: "hintclose", hintopen: "hintopen", marginchange: "marginchange", yamousedown: "yamousedown", yamouseenter: "yamouseenter", yamouseleave: "yamouseleave", yamousemove: "yamousemove", yamouseup: "yamouseup", multitouchend: "multitouchend", multitouchmove: "multitouchmove", multitouchstart: "multitouchstart", optionschange: "optionschange", sizechange: "sizechange", typechange: "typechange", yawheel: "yawheel" }, viewQueries: [{ propertyName: "container", first: true, predicate: ["container"], descendants: true }], usesOnChanges: true, ngImport: i0, template: '<div #container></div>', isInline: true, changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.0.2", ngImport: i0, type: YaMapComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'ya-map',
                    template: '<div #container></div>',
                    changeDetection: ChangeDetectionStrategy.OnPush,
                }]
        }], ctorParameters: function () { return [{ type: i0.NgZone }, { type: i1.YaApiLoaderService }, { type: Object, decorators: [{
                    type: Inject,
                    args: [PLATFORM_ID]
                }] }]; }, propDecorators: { container: [{
                type: ViewChild,
                args: ['container']
            }], center: [{
                type: Input
            }], zoom: [{
                type: Input
            }], state: [{
                type: Input
            }], options: [{
                type: Input
            }], ready: [{
                type: Output
            }], actionbegin: [{
                type: Output
            }], actionbreak: [{
                type: Output
            }], actionend: [{
                type: Output
            }], actiontick: [{
                type: Output
            }], actiontickcomplete: [{
                type: Output
            }], balloonclose: [{
                type: Output
            }], balloonopen: [{
                type: Output
            }], boundschange: [{
                type: Output
            }], yaclick: [{
                type: Output
            }], yacontextmenu: [{
                type: Output
            }], yadblclick: [{
                type: Output
            }], destroy: [{
                type: Output
            }], hintclose: [{
                type: Output
            }], hintopen: [{
                type: Output
            }], marginchange: [{
                type: Output
            }], yamousedown: [{
                type: Output
            }], yamouseenter: [{
                type: Output
            }], yamouseleave: [{
                type: Output
            }], yamousemove: [{
                type: Output
            }], yamouseup: [{
                type: Output
            }], multitouchend: [{
                type: Output
            }], multitouchmove: [{
                type: Output
            }], multitouchstart: [{
                type: Output
            }], optionschange: [{
                type: Output
            }], sizechange: [{
                type: Output
            }], typechange: [{
                type: Output
            }], yawheel: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoieWEtbWFwLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2FuZ3VsYXI4LXlhbmRleC1tYXBzL3NyYy9saWIvY29tcG9uZW50cy95YS1tYXAveWEtbWFwLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBRUwsdUJBQXVCLEVBQ3ZCLFNBQVMsRUFFVCxZQUFZLEVBQ1osTUFBTSxFQUNOLEtBQUssRUFJTCxNQUFNLEVBQ04sV0FBVyxFQUVYLFNBQVMsR0FDVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUNwRCxPQUFPLEVBQUUsZUFBZSxFQUFjLFlBQVksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNqRSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDbkQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7OztBQUtsRTs7Ozs7Ozs7Ozs7Ozs7R0FjRztBQU1ILE1BQU0sT0FBTyxjQUFjO0lBMk16QixZQUNtQixPQUFlLEVBQ2YsbUJBQXVDO0lBQ3hEOzs7T0FHRztJQUNILHdEQUF3RDtJQUNuQyxVQUFrQjtRQVB0QixZQUFPLEdBQVAsT0FBTyxDQUFRO1FBQ2Ysd0JBQW1CLEdBQW5CLG1CQUFtQixDQUFvQjtRQTFNekMsU0FBSSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFFMUIsa0JBQWEsR0FBRyxJQUFJLFlBQVksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFFaEUsU0FBSSxHQUFHLElBQUksZUFBZSxDQUF3QixTQUFTLENBQUMsQ0FBQztRQThCN0Q7O1dBRUc7UUFDTyxVQUFLLEdBQTBDLElBQUksWUFBWSxFQUV0RSxDQUFDO1FBRUo7O1dBRUc7UUFDTyxnQkFBVyxHQUNuQixJQUFJLENBQUMsYUFBYSxDQUFDLGNBQWMs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QWhCLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBZnRlclZpZXdJbml0LFxuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ29tcG9uZW50LFxuICBFbGVtZW50UmVmLFxuICBFdmVudEVtaXR0ZXIsXG4gIEluamVjdCxcbiAgSW5wdXQsXG4gIE5nWm9uZSxcbiAgT25DaGFuZ2VzLFxuICBPbkRlc3Ryb3ksXG4gIE91dHB1dCxcbiAgUExBVEZPUk1fSUQsXG4gIFNpbXBsZUNoYW5nZXMsXG4gIFZpZXdDaGlsZCxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBpc1BsYXRmb3JtQnJvd3NlciB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIE9ic2VydmFibGUsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgRXZlbnRNYW5hZ2VyIH0gZnJvbSAnLi4vLi4vZXZlbnQtbWFuYWdlcic7XG5pbXBvcnQgeyBnZW5lcmF0ZVJhbmRvbUlkIH0gZnJvbSAnLi4vLi4vdXRpbHMvZ2VuZXJhdGUtcmFuZG9tLWlkJztcbmltcG9ydCB7IFlhQXBpTG9hZGVyU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3lhLWFwaS1sb2FkZXIveWEtYXBpLWxvYWRlci5zZXJ2aWNlJztcbmltcG9ydCB7IFlhUmVhZHlFdmVudCB9IGZyb20gJy4uLy4uL3R5cGluZ3MveWEtcmVhZHktZXZlbnQnO1xuaW1wb3J0IHsgWWFFdmVudCB9IGZyb20gJy4uLy4uL3R5cGluZ3MveWEtZXZlbnQnO1xuXG4vKipcbiAqIFRoZSBgeWEtbWFwYCBjb21wb25lbnQgd3JhcHMgYHltYXBzLk1hcGAgY2xhc3MgZnJvbSB0aGUgWWFuZGV4Lk1hcHMgQVBJLlxuICogWW91IGNhbiBjb25maWd1cmUgdGhlIG1hcCB2aWEgdGhlIGNvbXBvbmVudCdzIGlucHV0cy5cbiAqIEV2ZW50cyBjYW4gYmUgYm91bmQgdXNpbmcgdGhlIG91dHB1dHMgb2YgdGhlIGNvbXBvbmVudC5cbiAqXG4gKiA8ZXhhbXBsZS11cmw+aHR0cHM6Ly9zdGFja2JsaXR6LmNvbS9lZGl0L21hcC1vbmxvYWQtZXZlbnQ/ZW1iZWQ9MTwvZXhhbXBsZS11cmw+XG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGh0bWxcbiAqIDx5YS1tYXBcbiAqICAgW2NlbnRlcl09XCJbNTUuNzUxOTUyLCAzNy42MDA3MzldXCJcbiAqICAgW3N0YXRlXT1cInt0eXBlOiAneWFuZGV4I3NhdGVsbGl0ZSd9XCJcbiAqID48L3lhLW1hcD5cbiAqIGBgYFxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICd5YS1tYXAnLFxuICB0ZW1wbGF0ZTogJzxkaXYgI2NvbnRhaW5lcj48L2Rpdj4nLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbn0pXG5leHBvcnQgY2xhc3MgWWFNYXBDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSB7XG4gIEBWaWV3Q2hpbGQoJ2NvbnRhaW5lcicpIGNvbnRhaW5lcjogRWxlbWVudFJlZjtcblxuICBwcml2YXRlIHJlYWRvbmx5IF9zdWIgPSBuZXcgU3Vic2NyaXB0aW9uKCk7XG5cbiAgcHJpdmF0ZSByZWFkb25seSBfZXZlbnRNYW5hZ2VyID0gbmV3IEV2ZW50TWFuYWdlcih0aGlzLl9uZ1pvbmUpO1xuXG4gIG1hcCQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PHltYXBzLk1hcCB8IHVuZGVmaW5lZD4odW5kZWZpbmVkKTtcblxuICBpc0Jyb3dzZXI6IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIE1hcCBjZW50ZXIgZ2VvY29vcmRpbmF0ZXMuIERlZmF1bHQgaXMgWzAsIDBdLlxuICAgKiBTaG9ydGhhbmQgZm9yIFtzdGF0ZV09XCJ7IGNlbnRlcjogWzAsIDBdIH1cIi5cbiAgICoge0BsaW5rIGh0dHBzOi8veWFuZGV4LmNvbS9kZXYvbWFwcy9qc2FwaS9kb2MvMi4xL3JlZi9yZWZlcmVuY2UvTWFwLmh0bWwjTWFwX19wYXJhbS1zdGF0ZS5jZW50ZXJ9XG4gICAqL1xuICBASW5wdXQoKSBjZW50ZXI6IG51bWJlcltdO1xuXG4gIC8qKlxuICAgKiBNYXAgem9vbSBsZXZlbC4gRGVmYXVsdCBsZXZlbCBpcyAxMC5cbiAgICogU2hvcnRoYW5kIGZvciBbc3RhdGVdPVwieyB6b29tOiAxMCB9XCIuXG4gICAqIHtAbGluayBodHRwczovL3lhbmRleC5jb20vZGV2L21hcHMvanNhcGkvZG9jLzIuMS9yZWYvcmVmZXJlbmNlL01hcC5odG1sI01hcF9fcGFyYW0tc3RhdGUuem9vbX1cbiAgICovXG4gIEBJbnB1dCgpIHpvb206IG51bWJlcjtcblxuICAvKipcbiAgICogU3RhdGVzIGZvciB0aGUgbWFwLlxuICAgKiB7QGxpbmsgaHR0cHM6Ly95YW5kZXguY29tL2Rldi9tYXBzL2pzYXBpL2RvYy8yLjEvcmVmL3JlZmVyZW5jZS9NYXAuaHRtbCNNYXBwYXJhbS1zdGF0ZX1cbiAgICovXG4gIEBJbnB1dCgpIHN0YXRlOiB5bWFwcy5JTWFwU3RhdGU7XG5cbiAgLyoqXG4gICAqIE9wdGlvbnMgZm9yIHRoZSBtYXAuXG4gICAqIHtAbGluayBodHRwczovL3lhbmRleC5jb20vZGV2L21hcHMvanNhcGkvZG9jLzIuMS9yZWYvcmVmZXJlbmNlL01hcC5odG1sI01hcHBhcmFtLW9wdGlvbnN9XG4gICAqL1xuICBASW5wdXQoKSBvcHRpb25zOiB5bWFwcy5JTWFwT3B0aW9ucztcblxuICAvKipcbiAgICogTWFwIGluc3RhbmNlIGlzIGNyZWF0ZWQuXG4gICAqL1xuICBAT3V0cHV0KCkgcmVhZHk6IEV2ZW50RW1pdHRlcjxZYVJlYWR5RXZlbnQ8eW1hcHMuTWFwPj4gPSBuZXcgRXZlbnRFbWl0dGVyPFxuICAgIFlhUmVhZHlFdmVudDx5bWFwcy5NYXA+XG4gID4oKTtcblxuICAvKipcbiAgICogVGhlIHN0YXJ0IG9mIGEgbmV3IHNtb290aCBtYXAgbW92ZW1lbnQuXG4gICAqL1xuICBAT3V0cHV0KCkgYWN0aW9uYmVnaW46IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5NYXA+PiA9XG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdhY3Rpb25iZWdpbicpO1xuXG4gIC8qKlxuICAgKiBFdmVudCB0aGF0IG9jY3VycyB3aGVuIGFuIGFjdGlvbiBzdGVwIHdhcyBwcmVtYXR1cmVseSBzdG9wcGVkLlxuICAgKi9cbiAgQE91dHB1dCgpIGFjdGlvbmJyZWFrOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuTWFwPj4gPVxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignYWN0aW9uYnJlYWsnKTtcblxuICAvKipcbiAgICogVGhlIGVuZCBvZiBzbW9vdGggbWFwIG1vdmVtZW50LlxuICAgKi9cbiAgQE91dHB1dCgpIGFjdGlvbmVuZDogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLk1hcD4+ID1cbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ2FjdGlvbmVuZCcpO1xuXG4gIC8qKlxuICAgKiBUaGUgc3RhcnQgb2YgYSBuZXcgc3RlcCBvZiBzbW9vdGggbW92ZW1lbnQuXG4gICAqL1xuICBAT3V0cHV0KCkgYWN0aW9udGljazogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLk1hcD4+ID1cbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ2FjdGlvbnRpY2snKTtcblxuICAvKipcbiAgICogVGhlIGVuZCBvZiBwZXJmb3JtaW5nIGEgc3RlcCBvZiBzbW9vdGggbW92ZW1lbnQuXG4gICAqL1xuICBAT3V0cHV0KCkgYWN0aW9udGlja2NvbXBsZXRlOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuTWFwPj4gPVxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignYWN0aW9udGlja2NvbXBsZXRlJyk7XG5cbiAgLyoqXG4gICAqIENsb3NpbmcgdGhlIGJhbGxvb24uXG4gICAqL1xuICBAT3V0cHV0KCkgYmFsbG9vbmNsb3NlOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuTWFwPj4gPVxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignYmFsbG9vbmNsb3NlJyk7XG5cbiAgLyoqXG4gICAqIE9wZW5pbmcgYSBiYWxsb29uIG9uIGEgbWFwLlxuICAgKi9cbiAgQE91dHB1dCgpIGJhbGxvb25vcGVuOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuTWFwPj4gPVxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignYmFsbG9vbm9wZW4nKTtcblxuICAvKipcbiAgICogRXZlbnQgZm9yIGEgY2hhbmdlIHRvIHRoZSBtYXAgdmlld3BvcnQuXG4gICAqL1xuICBAT3V0cHV0KCkgYm91bmRzY2hhbmdlOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuTWFwPj4gPVxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignYm91bmRzY2hhbmdlJyk7XG5cbiAgLyoqXG4gICAqIFNpbmdsZSBsZWZ0LWNsaWNrIG9uIHRoZSBvYmplY3QuXG4gICAqL1xuICBAT3V0cHV0KCkgeWFjbGljazogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLk1hcD4+ID0gdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdjbGljaycpO1xuXG4gIC8qKlxuICAgKiBDYWxscyB0aGUgZWxlbWVudCdzIGNvbnRleHQgbWVudS5cbiAgICovXG4gIEBPdXRwdXQoKSB5YWNvbnRleHRtZW51OiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuTWFwPj4gPVxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignY29udGV4dG1lbnUnKTtcblxuICAvKipcbiAgICogRG91YmxlIGxlZnQtY2xpY2sgb24gdGhlIG9iamVjdC5cbiAgICovXG4gIEBPdXRwdXQoKSB5YWRibGNsaWNrOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuTWFwPj4gPVxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignZGJsY2xpY2snKTtcblxuICAvKipcbiAgICogVGhlIG1hcCB3YXMgZGVzdHJveWVkLlxuICAgKi9cbiAgQE91dHB1dCgpIGRlc3Ryb3k6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5NYXA+PiA9IHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignZGVzdHJveScpO1xuXG4gIC8qKlxuICAgKiBDbG9zaW5nIHRoZSBoaW50LlxuICAgKi9cbiAgQE91dHB1dCgpIGhpbnRjbG9zZTogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLk1hcD4+ID1cbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ2hpbnRjbG9zZScpO1xuXG4gIC8qKlxuICAgKiBPcGVuaW5nIGEgaGludCBvbiBhIG1hcC5cbiAgICovXG4gIEBPdXRwdXQoKSBoaW50b3BlbjogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLk1hcD4+ID1cbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ2hpbnRvcGVuJyk7XG5cbiAgLyoqXG4gICAqIE1hcCBtYXJnaW5zIGNoYW5nZWQuXG4gICAqL1xuICBAT3V0cHV0KCkgbWFyZ2luY2hhbmdlOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuTWFwPj4gPVxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignbWFyZ2luY2hhbmdlJyk7XG5cbiAgLyoqXG4gICAqIFByZXNzaW5nIHRoZSBtb3VzZSBidXR0b24gb3ZlciB0aGUgb2JqZWN0LlxuICAgKi9cbiAgQE91dHB1dCgpIHlhbW91c2Vkb3duOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuTWFwPj4gPVxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignbW91c2Vkb3duJyk7XG5cbiAgLyoqXG4gICAqIFBvaW50aW5nIHRoZSBjdXJzb3IgYXQgdGhlIG9iamVjdC5cbiAgICovXG4gIEBPdXRwdXQoKSB5YW1vdXNlZW50ZXI6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5NYXA+PiA9XG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdtb3VzZWVudGVyJyk7XG5cbiAgLyoqXG4gICAqIE1vdmluZyB0aGUgY3Vyc29yIG9mZiBvZiB0aGUgb2JqZWN0LlxuICAgKi9cbiAgQE91dHB1dCgpIHlhbW91c2VsZWF2ZTogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLk1hcD4+ID1cbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ21vdXNlbGVhdmUnKTtcblxuICAvKipcbiAgICogTW92aW5nIHRoZSBjdXJzb3Igb3ZlciB0aGUgb2JqZWN0LlxuICAgKi9cbiAgQE91dHB1dCgpIHlhbW91c2Vtb3ZlOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuTWFwPj4gPVxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignbW91c2Vtb3ZlJyk7XG5cbiAgLyoqXG4gICAqIExldHRpbmcgZ28gb2YgdGhlIG1vdXNlIGJ1dHRvbiBvdmVyIGFuIG9iamVjdC5cbiAgICovXG4gIEBPdXRwdXQoKSB5YW1vdXNldXA6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5NYXA+PiA9XG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdtb3VzZXVwJyk7XG5cbiAgLyoqXG4gICAqIEVuZCBvZiBtdWx0aXRvdWNoLlxuICAgKi9cbiAgQE91dHB1dCgpIG11bHRpdG91Y2hlbmQ6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5NYXA+PiA9XG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdtdWx0aXRvdWNoZW5kJyk7XG5cbiAgLyoqXG4gICAqIFJlcGVhdGluZyBldmVudCBkdXJpbmcgbXVsdGl0b3VjaC5cbiAgICovXG4gIEBPdXRwdXQoKSBtdWx0aXRvdWNobW92ZTogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLk1hcD4+ID1cbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ211bHRpdG91Y2htb3ZlJyk7XG5cbiAgLyoqXG4gICAqIFN0YXJ0IG9mIG11bHRpdG91Y2guXG4gICAqL1xuICBAT3V0cHV0KCkgbXVsdGl0b3VjaHN0YXJ0OiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuTWFwPj4gPVxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignbXVsdGl0b3VjaHN0YXJ0Jyk7XG5cbiAgLyoqXG4gICAqIE1hcCBvcHRpb25zIGNoYW5nZWQuXG4gICAqL1xuICBAT3V0cHV0KCkgb3B0aW9uc2NoYW5nZTogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLk1hcD4+ID1cbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ29wdGlvbnNjaGFuZ2UnKTtcblxuICAvKipcbiAgICogTWFwIHNpemUgY2hhbmdlZC5cbiAgICovXG4gIEBPdXRwdXQoKSBzaXplY2hhbmdlOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuTWFwPj4gPVxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignc2l6ZWNoYW5nZScpO1xuXG4gIC8qKlxuICAgKiBUaGUgbWFwIHR5cGUgY2hhbmdlZC5cbiAgICovXG4gIEBPdXRwdXQoKSB0eXBlY2hhbmdlOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuTWFwPj4gPVxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcigndHlwZWNoYW5nZScpO1xuXG4gIC8qKlxuICAgKiBNb3VzZSB3aGVlbCBzY3JvbGxpbmcuXG4gICAqL1xuICBAT3V0cHV0KCkgeWF3aGVlbDogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLk1hcD4+ID0gdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCd3aGVlbCcpO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcmVhZG9ubHkgX25nWm9uZTogTmdab25lLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgX3lhQXBpTG9hZGVyU2VydmljZTogWWFBcGlMb2FkZXJTZXJ2aWNlLFxuICAgIC8qXG4gICAgICogV2UgbmVlZCB0byB1c2UgdGhlIHNhbWUgdHlwZSBsaWtlIGluIGFuIEFuZ3VsYXIuXG4gICAgICogXCJleHBvcnQgZGVjbGFyZSBjb25zdCBQTEFURk9STV9JRDogSW5qZWN0aW9uVG9rZW48T2JqZWN0PlwiXG4gICAgICovXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHlwZXNcbiAgICBASW5qZWN0KFBMQVRGT1JNX0lEKSBwbGF0Zm9ybUlkOiBPYmplY3QsXG4gICkge1xuICAgIHRoaXMuaXNCcm93c2VyID0gaXNQbGF0Zm9ybUJyb3dzZXIocGxhdGZvcm1JZCk7XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlcyBpbnB1dCBjaGFuZ2VzIGFuZCBwYXNzZXMgdGhlbSBpbiBBUEkuXG4gICAqIEBwYXJhbSBjaGFuZ2VzXG4gICAqL1xuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XG4gICAgY29uc3QgbWFwID0gdGhpcy5tYXAkLnZhbHVlO1xuXG4gICAgaWYgKG1hcCkge1xuICAgICAgY29uc3QgeyBjZW50ZXIsIHpvb20sIHN0YXRlLCBvcHRpb25zIH0gPSBjaGFuZ2VzO1xuXG4gICAgICBpZiAoc3RhdGUpIHtcbiAgICAgICAgdGhpcy5fc2V0U3RhdGUodGhpcy5fY29tYmluZVN0YXRlKCksIG1hcCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChjZW50ZXIpIHtcbiAgICAgICAgbWFwLnNldENlbnRlcihjZW50ZXIuY3VycmVudFZhbHVlKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHpvb20pIHtcbiAgICAgICAgbWFwLnNldFpvb20oem9vbS5jdXJyZW50VmFsdWUpO1xuICAgICAgfVxuXG4gICAgICBpZiAob3B0aW9ucykge1xuICAgICAgICBtYXAub3B0aW9ucy5zZXQob3B0aW9ucy5jdXJyZW50VmFsdWUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcbiAgICAvKipcbiAgICAgKiBJdCBzaG91bGQgYmUgYSBub29wIGR1cmluZyBzZXJ2ZXItc2lkZSByZW5kZXJpbmcuXG4gICAgICovXG4gICAgaWYgKHRoaXMuaXNCcm93c2VyKSB7XG4gICAgICBjb25zdCBzdWIgPSB0aGlzLl95YUFwaUxvYWRlclNlcnZpY2UubG9hZCgpLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgIGNvbnN0IGlkID0gZ2VuZXJhdGVSYW5kb21JZCgpO1xuICAgICAgICBjb25zdCBtYXAgPSB0aGlzLl9jcmVhdGVNYXAoaWQpO1xuXG4gICAgICAgIHRoaXMubWFwJC5uZXh0KG1hcCk7XG4gICAgICAgIHRoaXMuX2V2ZW50TWFuYWdlci5zZXRUYXJnZXQobWFwKTtcbiAgICAgICAgdGhpcy5fbmdab25lLnJ1bigoKSA9PiB0aGlzLnJlYWR5LmVtaXQoeyB5bWFwcywgdGFyZ2V0OiBtYXAgfSkpO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuX3N1Yi5hZGQoc3ViKTtcbiAgICB9XG4gIH1cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZGVzdHJveSgpO1xuICAgIHRoaXMuX3N1Yi51bnN1YnNjcmliZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIERlc3RydWN0cyBzdGF0ZSBhbmQgcGFzc2VzIGl0IGluIEFQSS5cbiAgICogQHBhcmFtIHN0YXRlXG4gICAqIEBwYXJhbSBtYXBcbiAgICovXG4gIHByaXZhdGUgX3NldFN0YXRlKHN0YXRlOiB5bWFwcy5JTWFwU3RhdGUsIG1hcDogeW1hcHMuTWFwKTogdm9pZCB7XG4gICAgY29uc3QgeyBiZWhhdmlvcnMsIGJvdW5kcywgY2VudGVyLCBjb250cm9scywgbWFyZ2luLCB0eXBlLCB6b29tIH0gPSBzdGF0ZTtcblxuICAgIGlmIChiZWhhdmlvcnMpIHtcbiAgICAgIG1hcC5iZWhhdmlvcnMuZW5hYmxlKGJlaGF2aW9ycyk7XG4gICAgfVxuXG4gICAgaWYgKGJvdW5kcykge1xuICAgICAgbWFwLnNldEJvdW5kcyhib3VuZHMpO1xuICAgIH1cblxuICAgIGlmIChjZW50ZXIpIHtcbiAgICAgIG1hcC5zZXRDZW50ZXIoY2VudGVyKTtcbiAgICB9XG5cbiAgICBpZiAoY29udHJvbHMpIHtcbiAgICAgIGNvbnRyb2xzLmZvckVhY2goKGNvbnRyb2wpID0+IG1hcC5jb250cm9scy5hZGQoY29udHJvbCkpO1xuICAgIH1cblxuICAgIGlmIChtYXJnaW4pIHtcbiAgICAgIG1hcC5tYXJnaW4uc2V0RGVmYXVsdE1hcmdpbihtYXJnaW4pO1xuICAgIH1cblxuICAgIGlmICh0eXBlKSB7XG4gICAgICBtYXAuc2V0VHlwZSh0eXBlKTtcbiAgICB9XG5cbiAgICBpZiAoem9vbSkge1xuICAgICAgbWFwLnNldFpvb20oem9vbSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBtYXAuXG4gICAqIEBwYXJhbSBpZCBJRCB3aGljaCB3aWxsIGJlIHNldCB0byB0aGUgbWFwIGNvbnRhaW5lci5cbiAgICovXG4gIHByaXZhdGUgX2NyZWF0ZU1hcChpZDogc3RyaW5nKTogeW1hcHMuTWFwIHtcbiAgICBjb25zdCBjb250YWluZXJFbGVtOiBIVE1MRWxlbWVudCA9IHRoaXMuY29udGFpbmVyLm5hdGl2ZUVsZW1lbnQ7XG4gICAgY29udGFpbmVyRWxlbS5zZXRBdHRyaWJ1dGUoJ2lkJywgaWQpO1xuICAgIGNvbnRhaW5lckVsZW0uc3R5bGUuY3NzVGV4dCA9ICd3aWR0aDogMTAwJTsgaGVpZ2h0OiAxMDAlOyc7XG5cbiAgICByZXR1cm4gbmV3IHltYXBzLk1hcChpZCwgdGhpcy5fY29tYmluZVN0YXRlKCksIHRoaXMub3B0aW9ucyB8fCB7fSk7XG4gIH1cblxuICAvKipcbiAgICogQ29tYmluZXMgdGhlIGNlbnRlciBhbmQgem9vbSBpbnRvIHNpbmdsZSBvYmplY3QuXG4gICAqL1xuICBwcml2YXRlIF9jb21iaW5lU3RhdGUoKTogeW1hcHMuSU1hcFN0YXRlIHtcbiAgICBjb25zdCBzdGF0ZSA9IHRoaXMuc3RhdGUgfHwge307XG5cbiAgICByZXR1cm4ge1xuICAgICAgLi4uc3RhdGUsXG4gICAgICBjZW50ZXI6IHRoaXMuY2VudGVyIHx8IHN0YXRlLmNlbnRlciB8fCBbMCwgMF0sXG4gICAgICB6b29tOiB0aGlzLnpvb20gPz8gc3RhdGUuem9vbSA/PyAxMCxcbiAgICB9O1xuICB9XG59XG4iXX0=