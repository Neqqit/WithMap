import { Directive, EventEmitter, Input, Output, } from '@angular/core';
import { Subscription } from 'rxjs';
import { EventManager } from '../../event-manager';
import * as i0 from "@angular/core";
import * as i1 from "../ya-map/ya-map.component";
/**
 * The `ya-multiroute` component wraps `ymaps.multiRouter.MultiRoute` class from the Yandex.Maps API.
 * You can configure it via the component's inputs.
 * Events can be bound using the outputs of the component.
 *
 * <example-url>https://stackblitz.com/edit/multiroute-pedestrian?embed=1</example-url>
 *
 * @example
 * ```html
 * <ya-map [center]="[55.761952, 37.620739]">
 *   <ya-multiroute
 *     [referencePoints]="[[55.751952, 37.600739], 'Красные ворота, Москва']"
 *     [model]="{ params: { routingMode: 'pedestrian' } }"
 *   ></ya-multiroute>
 * </ya-map>
 * ```
 */
export class YaMultirouteDirective {
    constructor(_ngZone, _yaMapComponent) {
        this._ngZone = _ngZone;
        this._yaMapComponent = _yaMapComponent;
        this._sub = new Subscription();
        this._eventManager = new EventManager(this._ngZone);
        /**
         * Multiroute instance is added in a Map.
         */
        this.ready = new EventEmitter();
        /**
         * Change to the active route.
         */
        this.activeroutechange = this._eventManager.getLazyEmitter('activeroutechange');
        /**
         * Closing the balloon.
         */
        this.balloonclose = this._eventManager.getLazyEmitter('balloonclose');
        /**
         * Opening a balloon on a map.
         */
        this.balloonopen = this._eventManager.getLazyEmitter('balloonopen');
        /**
         * The event occurs at the time of setting the map center and its zoom level for optimal display of the multi-route.
         */
        this.boundsautoapply = this._eventManager.getLazyEmitter('boundsautoapply');
        /**
         * Changing coordinates of the geographical area covering the multi-route.
         */
        this.boundschange = this._eventManager.getLazyEmitter('boundschange');
        /**
         * Single left-click on the object.
         */
        this.yaclick = this._eventManager.getLazyEmitter('click');
        /**
         * Calls the element's context menu.
         */
        this.yacontextmenu = this._eventManager.getLazyEmitter('contextmenu');
        /**
         * Double left-click on the object.
         */
        this.yadblclick = this._eventManager.getLazyEmitter('dblclick');
        /**
         * Change to the geo object geometry.
         */
        this.geometrychange = this._eventManager.getLazyEmitter('geometrychange');
        /**
         * Map reference changed.
         */
        this.mapchange = this._eventManager.getLazyEmitter('mapchange');
        /**
         * Pressing the mouse button over the object.
         */
        this.yamousedown = this._eventManager.getLazyEmitter('mousedown');
        /**
         * Pointing the cursor at the object.
         */
        this.yamouseenter = this._eventManager.getLazyEmitter('mouseenter');
        /**
         * Moving the cursor off of the object.
         */
        this.yamouseleave = this._eventManager.getLazyEmitter('mouseleave');
        /**
         * Moving the cursor over the object.
         */
        this.yamousemove = this._eventManager.getLazyEmitter('mousemove');
        /**
         * Letting go of the mouse button over an object.
         */
        this.yamouseup = this._eventManager.getLazyEmitter('mouseup');
        /**
         * End of multitouch.
         */
        this.multitouchend = this._eventManager.getLazyEmitter('multitouchend');
        /**
         * Repeating event during multitouch.
         */
        this.multitouchmove = this._eventManager.getLazyEmitter('multitouchmove');
        /**
         * Start of multitouch.
         */
        this.multitouchstart = this._eventManager.getLazyEmitter('multitouchstart');
        /**
         * Change to the object options.
         */
        this.optionschange = this._eventManager.getLazyEmitter('optionschange');
        /**
         * Change to the geo object overlay.
         */
        this.overlaychange = this._eventManager.getLazyEmitter('overlaychange');
        /**
         * The parent object reference changed.
         */
        this.parentchange = this._eventManager.getLazyEmitter('parentchange');
        /**
         * Changing pixel coordinates of the area covering the multi-route.
         */
        this.pixelboundschange = this._eventManager.getLazyEmitter('pixelboundschange');
        /**
         * Change to the geo object data.
         */
        this.propertieschange = this._eventManager.getLazyEmitter('propertieschange');
        /**
         * Updating the multi-route.
         */
        this.update = this._eventManager.getLazyEmitter('update');
        /**
         * Mouse wheel scrolling.
         */
        this.yawheel = this._eventManager.getLazyEmitter('wheel');
    }
    /**
     * Handles input changes and passes them in API.
     * @param changes
     */
    ngOnChanges(changes) {
        const multiroute = this._multiroute;
        if (multiroute) {
            const { referencePoints, model, options } = changes;
            if (model) {
                this._setModel(model.currentValue, multiroute);
            }
            if (referencePoints) {
                multiroute.model.setReferencePoints(referencePoints.currentValue);
            }
            if (options) {
                multiroute.options.set(options.currentValue);
            }
        }
    }
    ngOnInit() {
        if (this._yaMapComponent.isBrowser) {
            const sub = this._yaMapComponent.map$.subscribe((map) => {
                if (map) {
                    const multiroute = this._createMultiroute();
                    this._multiroute = multiroute;
                    map.geoObjects.add(multiroute);
                    this._eventManager.setTarget(multiroute);
                    this._ngZone.run(() => this.ready.emit({ ymaps, target: multiroute }));
                }
            });
            this._sub.add(sub);
        }
    }
    ngOnDestroy() {
        if (this._multiroute) {
            this._yaMapComponent?.map$.value?.geoObjects.remove(this._multiroute);
            this._eventManager.destroy();
        }
        this._sub.unsubscribe();
    }
    /**
     * Destructs state and passes them in API.
     * @param model
     * @param multiroute
     */
    _setModel(model, multiroute) {
        const { referencePoints, params } = model;
        if (referencePoints) {
            multiroute.model.setReferencePoints(referencePoints);
        }
        if (params) {
            multiroute.model.setParams(params);
        }
    }
    /**
     * Creates Multiroute.
     */
    _createMultiroute() {
        return new ymaps.multiRouter.MultiRoute(this._combineModel(), this.options);
    }
    /**
     * Combines the model and reference points into single object
     */
    _combineModel() {
        const model = (this.model || {});
        return {
            ...model,
            referencePoints: this.referencePoints || model.referencePoints,
        };
    }
}
YaMultirouteDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.0.2", ngImport: i0, type: YaMultirouteDirective, deps: [{ token: i0.NgZone }, { token: i1.YaMapComponent }], target: i0.ɵɵFactoryTarget.Directive });
YaMultirouteDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "13.0.2", type: YaMultirouteDirective, selector: "ya-multiroute", inputs: { referencePoints: "referencePoints", model: "model", options: "options" }, outputs: { ready: "ready", activeroutechange: "activeroutechange", balloonclose: "balloonclose", balloonopen: "balloonopen", boundsautoapply: "boundsautoapply", boundschange: "boundschange", yaclick: "yaclick", yacontextmenu: "yacontextmenu", yadblclick: "yadblclick", geometrychange: "geometrychange", mapchange: "mapchange", yamousedown: "yamousedown", yamouseenter: "yamouseenter", yamouseleave: "yamouseleave", yamousemove: "yamousemove", yamouseup: "yamouseup", multitouchend: "multitouchend", multitouchmove: "multitouchmove", multitouchstart: "multitouchstart", optionschange: "optionschange", overlaychange: "overlaychange", parentchange: "parentchange", pixelboundschange: "pixelboundschange", propertieschange: "propertieschange", update: "update", yawheel: "yawheel" }, usesOnChanges: true, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.0.2", ngImport: i0, type: YaMultirouteDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: 'ya-multiroute',
                }]
        }], ctorParameters: function () { return [{ type: i0.NgZone }, { type: i1.YaMapComponent }]; }, propDecorators: { referencePoints: [{
                type: Input
            }], model: [{
                type: Input
            }], options: [{
                type: Input
            }], ready: [{
                type: Output
            }], activeroutechange: [{
                type: Output
            }], balloonclose: [{
                type: Output
            }], balloonopen: [{
                type: Output
            }], boundsautoapply: [{
                type: Output
            }], boundschange: [{
                type: Output
            }], yaclick: [{
                type: Output
            }], yacontextmenu: [{
                type: Output
            }], yadblclick: [{
                type: Output
            }], geometrychange: [{
                type: Output
            }], mapchange: [{
                type: Output
            }], yamousedown: [{
                type: Output
            }], yamouseenter: [{
                type: Output
            }], yamouseleave: [{
                type: Output
            }], yamousemove: [{
                type: Output
            }], yamouseup: [{
                type: Output
            }], multitouchend: [{
                type: Output
            }], multitouchmove: [{
                type: Output
            }], multitouchstart: [{
                type: Output
            }], optionschange: [{
                type: Output
            }], overlaychange: [{
                type: Output
            }], parentchange: [{
                type: Output
            }], pixelboundschange: [{
                type: Output
            }], propertieschange: [{
                type: Output
            }], update: [{
                type: Output
            }], yawheel: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoieWEtbXVsdGlyb3V0ZS5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9hbmd1bGFyOC15YW5kZXgtbWFwcy9zcmMvbGliL2NvbXBvbmVudHMveWEtbXVsdGlyb3V0ZS95YS1tdWx0aXJvdXRlLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULFlBQVksRUFDWixLQUFLLEVBS0wsTUFBTSxHQUVQLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBYyxZQUFZLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDaEQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLHFCQUFxQixDQUFDOzs7QUFVbkQ7Ozs7Ozs7Ozs7Ozs7Ozs7R0FnQkc7QUFJSCxNQUFNLE9BQU8scUJBQXFCO0lBeUxoQyxZQUE2QixPQUFlLEVBQW1CLGVBQStCO1FBQWpFLFlBQU8sR0FBUCxPQUFPLENBQVE7UUFBbUIsb0JBQWUsR0FBZixlQUFlLENBQWdCO1FBeEw3RSxTQUFJLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUUxQixrQkFBYSxHQUFHLElBQUksWUFBWSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQXlCaEU7O1dBRUc7UUFDTyxVQUFLLEdBQTZELElBQUksWUFBWSxFQUV6RixDQUFDO1FBRUo7O1dBRUc7UUFDTyxzQkFBaUIsR0FDekIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxjQUFjLENBQUMsbUJBQW1CLENBQUMsQ0FBQztRQUV6RDs7V0FFRztRQUNPLGlCQUFZLEdBQ3BCLElBQUksQ0FBQyxhQUFhLENBQUMsY0FBYyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBRXBEOztXQUVHO1FBQ08sZ0JBQVcsR0FDbkIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxjQUFjLENBQUMsYUFBYSxDQUFDLENBQUM7UUFFbkQ7O1dBRUc7UUFDTyxvQkFBZSxHQUN2QixJQUFJ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aUJBQWlCO3NCQUExQixNQUFNO2dCQU1HLFlBQVk7c0JBQXJCLE1BQU07Z0JBTUcsV0FBVztzQkFBcEIsTUFBTTtnQkFNRyxlQUFlO3NCQUF4QixNQUFNO2dCQU1HLFlBQVk7c0JBQXJCLE1BQU07Z0JBTUcsT0FBTztzQkFBaEIsTUFBTTtnQkFNRyxhQUFhO3NCQUF0QixNQUFNO2dCQU1HLFVBQVU7c0JBQW5CLE1BQU07Z0JBTUcsY0FBYztzQkFBdkIsTUFBTTtnQkFNRyxTQUFTO3NCQUFsQixNQUFNO2dCQU1HLFdBQVc7c0JBQXBCLE1BQU07Z0JBTUcsWUFBWTtzQkFBckIsTUFBTTtnQkFNRyxZQUFZO3NCQUFyQixNQUFNO2dCQU1HLFdBQVc7c0JBQXBCLE1BQU07Z0JBTUcsU0FBUztzQkFBbEIsTUFBTTtnQkFNRyxhQUFhO3NCQUF0QixNQUFNO2dCQU1HLGNBQWM7c0JBQXZCLE1BQU07Z0JBTUcsZUFBZTtzQkFBeEIsTUFBTTtnQkFNRyxhQUFhO3NCQUF0QixNQUFNO2dCQU1HLGFBQWE7c0JBQXRCLE1BQU07Z0JBTUcsWUFBWTtzQkFBckIsTUFBTTtnQkFNRyxpQkFBaUI7c0JBQTFCLE1BQU07Z0JBTUcsZ0JBQWdCO3NCQUF6QixNQUFNO2dCQU1HLE1BQU07c0JBQWYsTUFBTTtnQkFNRyxPQUFPO3NCQUFoQixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgRGlyZWN0aXZlLFxuICBFdmVudEVtaXR0ZXIsXG4gIElucHV0LFxuICBOZ1pvbmUsXG4gIE9uQ2hhbmdlcyxcbiAgT25EZXN0cm95LFxuICBPbkluaXQsXG4gIE91dHB1dCxcbiAgU2ltcGxlQ2hhbmdlcyxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IEV2ZW50TWFuYWdlciB9IGZyb20gJy4uLy4uL2V2ZW50LW1hbmFnZXInO1xuaW1wb3J0IHsgWWFNYXBDb21wb25lbnQgfSBmcm9tICcuLi95YS1tYXAveWEtbWFwLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBZYVJlYWR5RXZlbnQgfSBmcm9tICcuLi8uLi90eXBpbmdzL3lhLXJlYWR5LWV2ZW50JztcbmltcG9ydCB7IFlhRXZlbnQgfSBmcm9tICcuLi8uLi90eXBpbmdzL3lhLWV2ZW50JztcblxuLyoqXG4gKiBAaW50ZXJuYWxcbiAqL1xudHlwZSBPcHRpb25hbDxULCBLIGV4dGVuZHMga2V5b2YgVD4gPSBQaWNrPFBhcnRpYWw8VD4sIEs+ICYgT21pdDxULCBLPjtcblxuLyoqXG4gKiBUaGUgYHlhLW11bHRpcm91dGVgIGNvbXBvbmVudCB3cmFwcyBgeW1hcHMubXVsdGlSb3V0ZXIuTXVsdGlSb3V0ZWAgY2xhc3MgZnJvbSB0aGUgWWFuZGV4Lk1hcHMgQVBJLlxuICogWW91IGNhbiBjb25maWd1cmUgaXQgdmlhIHRoZSBjb21wb25lbnQncyBpbnB1dHMuXG4gKiBFdmVudHMgY2FuIGJlIGJvdW5kIHVzaW5nIHRoZSBvdXRwdXRzIG9mIHRoZSBjb21wb25lbnQuXG4gKlxuICogPGV4YW1wbGUtdXJsPmh0dHBzOi8vc3RhY2tibGl0ei5jb20vZWRpdC9tdWx0aXJvdXRlLXBlZGVzdHJpYW4/ZW1iZWQ9MTwvZXhhbXBsZS11cmw+XG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGh0bWxcbiAqIDx5YS1tYXAgW2NlbnRlcl09XCJbNTUuNzYxOTUyLCAzNy42MjA3MzldXCI+XG4gKiAgIDx5YS1tdWx0aXJvdXRlXG4gKiAgICAgW3JlZmVyZW5jZVBvaW50c109XCJbWzU1Ljc1MTk1MiwgMzcuNjAwNzM5XSwgJ9Ca0YDQsNGB0L3Ri9C1INCy0L7RgNC+0YLQsCwg0JzQvtGB0LrQstCwJ11cIlxuICogICAgIFttb2RlbF09XCJ7IHBhcmFtczogeyByb3V0aW5nTW9kZTogJ3BlZGVzdHJpYW4nIH0gfVwiXG4gKiAgID48L3lhLW11bHRpcm91dGU+XG4gKiA8L3lhLW1hcD5cbiAqIGBgYFxuICovXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICd5YS1tdWx0aXJvdXRlJyxcbn0pXG5leHBvcnQgY2xhc3MgWWFNdWx0aXJvdXRlRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgX3N1YiA9IG5ldyBTdWJzY3JpcHRpb24oKTtcblxuICBwcml2YXRlIHJlYWRvbmx5IF9ldmVudE1hbmFnZXIgPSBuZXcgRXZlbnRNYW5hZ2VyKHRoaXMuX25nWm9uZSk7XG5cbiAgcHJpdmF0ZSBfbXVsdGlyb3V0ZT86IHltYXBzLm11bHRpUm91dGVyLk11bHRpUm91dGU7XG5cbiAgLyoqXG4gICAqIFJlZmVyZW5jZSBwb2ludHMgZm9yIHRoZSBtdWx0aXJvdXRlLlxuICAgKiBTaG9ydGhhbmQgZm9yIFttb2RlbF09XCJ7IHJlZmVyZW5jZVBvaW50czogWzAsIDBdIH1cIi5cbiAgICoge0BsaW5rIGh0dHBzOi8veWFuZGV4LmNvbS9kZXYvbWFwcy9qc2FwaS9kb2MvMi4xL3JlZi9yZWZlcmVuY2UvSU11bHRpUm91dGVSZWZlcmVuY2VQb2ludC5odG1sfVxuICAgKi9cbiAgQElucHV0KCkgcmVmZXJlbmNlUG9pbnRzOiB5bWFwcy5JTXVsdGlSb3V0ZVJlZmVyZW5jZVBvaW50W107XG5cbiAgLyoqXG4gICAqIE1vZGVsIGRlc2NyaXB0aW9uIG9iamVjdCBvZiBhIG11bHRpcm91dGUuXG4gICAqIHtAbGluayBodHRwczovL3lhbmRleC5jb20vZGV2L21hcHMvanNhcGkvZG9jLzIuMS9yZWYvcmVmZXJlbmNlL0lNdWx0aVJvdXRlTW9kZWxKc29uLmh0bWx9XG4gICAqL1xuICBASW5wdXQoKSBtb2RlbDpcbiAgICB8IHltYXBzLm11bHRpUm91dGVyLk11bHRpUm91dGVNb2RlbFxuICAgIHwgT3B0aW9uYWw8eW1hcHMuSU11bHRpUm91dGVNb2RlbEpzb24sICdyZWZlcmVuY2VQb2ludHMnPjtcblxuICAvKipcbiAgICogT3B0aW9ucyBmb3IgdGhlIG11bHRpcm91dGUuXG4gICAqIHtAbGluayBodHRwczovL3lhbmRleC5jb20vZGV2L21hcHMvanNhcGkvZG9jLzIuMS9yZWYvcmVmZXJlbmNlL211bHRpUm91dGVyLk11bHRpUm91dGUuaHRtbCNtdWx0aVJvdXRlci5NdWx0aVJvdXRlX19wYXJhbS1vcHRpb25zfVxuICAgKi9cbiAgQElucHV0KCkgb3B0aW9uczogeW1hcHMubXVsdGlSb3V0ZXIuSU11bHRpUm91dGVPcHRpb25zO1xuXG4gIC8qKlxuICAgKiBNdWx0aXJvdXRlIGluc3RhbmNlIGlzIGFkZGVkIGluIGEgTWFwLlxuICAgKi9cbiAgQE91dHB1dCgpIHJlYWR5OiBFdmVudEVtaXR0ZXI8WWFSZWFkeUV2ZW50PHltYXBzLm11bHRpUm91dGVyLk11bHRpUm91dGU+PiA9IG5ldyBFdmVudEVtaXR0ZXI8XG4gICAgWWFSZWFkeUV2ZW50PHltYXBzLm11bHRpUm91dGVyLk11bHRpUm91dGU+XG4gID4oKTtcblxuICAvKipcbiAgICogQ2hhbmdlIHRvIHRoZSBhY3RpdmUgcm91dGUuXG4gICAqL1xuICBAT3V0cHV0KCkgYWN0aXZlcm91dGVjaGFuZ2U6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5tdWx0aVJvdXRlci5NdWx0aVJvdXRlPj4gPVxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignYWN0aXZlcm91dGVjaGFuZ2UnKTtcblxuICAvKipcbiAgICogQ2xvc2luZyB0aGUgYmFsbG9vbi5cbiAgICovXG4gIEBPdXRwdXQoKSBiYWxsb29uY2xvc2U6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5tdWx0aVJvdXRlci5NdWx0aVJvdXRlPj4gPVxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignYmFsbG9vbmNsb3NlJyk7XG5cbiAgLyoqXG4gICAqIE9wZW5pbmcgYSBiYWxsb29uIG9uIGEgbWFwLlxuICAgKi9cbiAgQE91dHB1dCgpIGJhbGxvb25vcGVuOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMubXVsdGlSb3V0ZXIuTXVsdGlSb3V0ZT4+ID1cbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ2JhbGxvb25vcGVuJyk7XG5cbiAgLyoqXG4gICAqIFRoZSBldmVudCBvY2N1cnMgYXQgdGhlIHRpbWUgb2Ygc2V0dGluZyB0aGUgbWFwIGNlbnRlciBhbmQgaXRzIHpvb20gbGV2ZWwgZm9yIG9wdGltYWwgZGlzcGxheSBvZiB0aGUgbXVsdGktcm91dGUuXG4gICAqL1xuICBAT3V0cHV0KCkgYm91bmRzYXV0b2FwcGx5OiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMubXVsdGlSb3V0ZXIuTXVsdGlSb3V0ZT4+ID1cbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ2JvdW5kc2F1dG9hcHBseScpO1xuXG4gIC8qKlxuICAgKiBDaGFuZ2luZyBjb29yZGluYXRlcyBvZiB0aGUgZ2VvZ3JhcGhpY2FsIGFyZWEgY292ZXJpbmcgdGhlIG11bHRpLXJvdXRlLlxuICAgKi9cbiAgQE91dHB1dCgpIGJvdW5kc2NoYW5nZTogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLm11bHRpUm91dGVyLk11bHRpUm91dGU+PiA9XG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdib3VuZHNjaGFuZ2UnKTtcblxuICAvKipcbiAgICogU2luZ2xlIGxlZnQtY2xpY2sgb24gdGhlIG9iamVjdC5cbiAgICovXG4gIEBPdXRwdXQoKSB5YWNsaWNrOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMubXVsdGlSb3V0ZXIuTXVsdGlSb3V0ZT4+ID1cbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ2NsaWNrJyk7XG5cbiAgLyoqXG4gICAqIENhbGxzIHRoZSBlbGVtZW50J3MgY29udGV4dCBtZW51LlxuICAgKi9cbiAgQE91dHB1dCgpIHlhY29udGV4dG1lbnU6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5tdWx0aVJvdXRlci5NdWx0aVJvdXRlPj4gPVxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignY29udGV4dG1lbnUnKTtcblxuICAvKipcbiAgICogRG91YmxlIGxlZnQtY2xpY2sgb24gdGhlIG9iamVjdC5cbiAgICovXG4gIEBPdXRwdXQoKSB5YWRibGNsaWNrOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMubXVsdGlSb3V0ZXIuTXVsdGlSb3V0ZT4+ID1cbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ2RibGNsaWNrJyk7XG5cbiAgLyoqXG4gICAqIENoYW5nZSB0byB0aGUgZ2VvIG9iamVjdCBnZW9tZXRyeS5cbiAgICovXG4gIEBPdXRwdXQoKSBnZW9tZXRyeWNoYW5nZTogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLm11bHRpUm91dGVyLk11bHRpUm91dGU+PiA9XG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdnZW9tZXRyeWNoYW5nZScpO1xuXG4gIC8qKlxuICAgKiBNYXAgcmVmZXJlbmNlIGNoYW5nZWQuXG4gICAqL1xuICBAT3V0cHV0KCkgbWFwY2hhbmdlOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMubXVsdGlSb3V0ZXIuTXVsdGlSb3V0ZT4+ID1cbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ21hcGNoYW5nZScpO1xuXG4gIC8qKlxuICAgKiBQcmVzc2luZyB0aGUgbW91c2UgYnV0dG9uIG92ZXIgdGhlIG9iamVjdC5cbiAgICovXG4gIEBPdXRwdXQoKSB5YW1vdXNlZG93bjogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLm11bHRpUm91dGVyLk11bHRpUm91dGU+PiA9XG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdtb3VzZWRvd24nKTtcblxuICAvKipcbiAgICogUG9pbnRpbmcgdGhlIGN1cnNvciBhdCB0aGUgb2JqZWN0LlxuICAgKi9cbiAgQE91dHB1dCgpIHlhbW91c2VlbnRlcjogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLm11bHRpUm91dGVyLk11bHRpUm91dGU+PiA9XG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdtb3VzZWVudGVyJyk7XG5cbiAgLyoqXG4gICAqIE1vdmluZyB0aGUgY3Vyc29yIG9mZiBvZiB0aGUgb2JqZWN0LlxuICAgKi9cbiAgQE91dHB1dCgpIHlhbW91c2VsZWF2ZTogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLm11bHRpUm91dGVyLk11bHRpUm91dGU+PiA9XG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdtb3VzZWxlYXZlJyk7XG5cbiAgLyoqXG4gICAqIE1vdmluZyB0aGUgY3Vyc29yIG92ZXIgdGhlIG9iamVjdC5cbiAgICovXG4gIEBPdXRwdXQoKSB5YW1vdXNlbW92ZTogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLm11bHRpUm91dGVyLk11bHRpUm91dGU+PiA9XG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdtb3VzZW1vdmUnKTtcblxuICAvKipcbiAgICogTGV0dGluZyBnbyBvZiB0aGUgbW91c2UgYnV0dG9uIG92ZXIgYW4gb2JqZWN0LlxuICAgKi9cbiAgQE91dHB1dCgpIHlhbW91c2V1cDogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLm11bHRpUm91dGVyLk11bHRpUm91dGU+PiA9XG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdtb3VzZXVwJyk7XG5cbiAgLyoqXG4gICAqIEVuZCBvZiBtdWx0aXRvdWNoLlxuICAgKi9cbiAgQE91dHB1dCgpIG11bHRpdG91Y2hlbmQ6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5tdWx0aVJvdXRlci5NdWx0aVJvdXRlPj4gPVxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignbXVsdGl0b3VjaGVuZCcpO1xuXG4gIC8qKlxuICAgKiBSZXBlYXRpbmcgZXZlbnQgZHVyaW5nIG11bHRpdG91Y2guXG4gICAqL1xuICBAT3V0cHV0KCkgbXVsdGl0b3VjaG1vdmU6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5tdWx0aVJvdXRlci5NdWx0aVJvdXRlPj4gPVxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignbXVsdGl0b3VjaG1vdmUnKTtcblxuICAvKipcbiAgICogU3RhcnQgb2YgbXVsdGl0b3VjaC5cbiAgICovXG4gIEBPdXRwdXQoKSBtdWx0aXRvdWNoc3RhcnQ6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5tdWx0aVJvdXRlci5NdWx0aVJvdXRlPj4gPVxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignbXVsdGl0b3VjaHN0YXJ0Jyk7XG5cbiAgLyoqXG4gICAqIENoYW5nZSB0byB0aGUgb2JqZWN0IG9wdGlvbnMuXG4gICAqL1xuICBAT3V0cHV0KCkgb3B0aW9uc2NoYW5nZTogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLm11bHRpUm91dGVyLk11bHRpUm91dGU+PiA9XG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdvcHRpb25zY2hhbmdlJyk7XG5cbiAgLyoqXG4gICAqIENoYW5nZSB0byB0aGUgZ2VvIG9iamVjdCBvdmVybGF5LlxuICAgKi9cbiAgQE91dHB1dCgpIG92ZXJsYXljaGFuZ2U6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5tdWx0aVJvdXRlci5NdWx0aVJvdXRlPj4gPVxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignb3ZlcmxheWNoYW5nZScpO1xuXG4gIC8qKlxuICAgKiBUaGUgcGFyZW50IG9iamVjdCByZWZlcmVuY2UgY2hhbmdlZC5cbiAgICovXG4gIEBPdXRwdXQoKSBwYXJlbnRjaGFuZ2U6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5tdWx0aVJvdXRlci5NdWx0aVJvdXRlPj4gPVxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcigncGFyZW50Y2hhbmdlJyk7XG5cbiAgLyoqXG4gICAqIENoYW5naW5nIHBpeGVsIGNvb3JkaW5hdGVzIG9mIHRoZSBhcmVhIGNvdmVyaW5nIHRoZSBtdWx0aS1yb3V0ZS5cbiAgICovXG4gIEBPdXRwdXQoKSBwaXhlbGJvdW5kc2NoYW5nZTogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLm11bHRpUm91dGVyLk11bHRpUm91dGU+PiA9XG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdwaXhlbGJvdW5kc2NoYW5nZScpO1xuXG4gIC8qKlxuICAgKiBDaGFuZ2UgdG8gdGhlIGdlbyBvYmplY3QgZGF0YS5cbiAgICovXG4gIEBPdXRwdXQoKSBwcm9wZXJ0aWVzY2hhbmdlOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMubXVsdGlSb3V0ZXIuTXVsdGlSb3V0ZT4+ID1cbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ3Byb3BlcnRpZXNjaGFuZ2UnKTtcblxuICAvKipcbiAgICogVXBkYXRpbmcgdGhlIG11bHRpLXJvdXRlLlxuICAgKi9cbiAgQE91dHB1dCgpIHVwZGF0ZTogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLm11bHRpUm91dGVyLk11bHRpUm91dGU+PiA9XG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCd1cGRhdGUnKTtcblxuICAvKipcbiAgICogTW91c2Ugd2hlZWwgc2Nyb2xsaW5nLlxuICAgKi9cbiAgQE91dHB1dCgpIHlhd2hlZWw6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5tdWx0aVJvdXRlci5NdWx0aVJvdXRlPj4gPVxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignd2hlZWwnKTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IF9uZ1pvbmU6IE5nWm9uZSwgcHJpdmF0ZSByZWFkb25seSBfeWFNYXBDb21wb25lbnQ6IFlhTWFwQ29tcG9uZW50KSB7fVxuXG4gIC8qKlxuICAgKiBIYW5kbGVzIGlucHV0IGNoYW5nZXMgYW5kIHBhc3NlcyB0aGVtIGluIEFQSS5cbiAgICogQHBhcmFtIGNoYW5nZXNcbiAgICovXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcbiAgICBjb25zdCBtdWx0aXJvdXRlID0gdGhpcy5fbXVsdGlyb3V0ZTtcblxuICAgIGlmIChtdWx0aXJvdXRlKSB7XG4gICAgICBjb25zdCB7IHJlZmVyZW5jZVBvaW50cywgbW9kZWwsIG9wdGlvbnMgfSA9IGNoYW5nZXM7XG5cbiAgICAgIGlmIChtb2RlbCkge1xuICAgICAgICB0aGlzLl9zZXRNb2RlbChtb2RlbC5jdXJyZW50VmFsdWUsIG11bHRpcm91dGUpO1xuICAgICAgfVxuXG4gICAgICBpZiAocmVmZXJlbmNlUG9pbnRzKSB7XG4gICAgICAgIG11bHRpcm91dGUubW9kZWwuc2V0UmVmZXJlbmNlUG9pbnRzKHJlZmVyZW5jZVBvaW50cy5jdXJyZW50VmFsdWUpO1xuICAgICAgfVxuXG4gICAgICBpZiAob3B0aW9ucykge1xuICAgICAgICBtdWx0aXJvdXRlLm9wdGlvbnMuc2V0KG9wdGlvbnMuY3VycmVudFZhbHVlKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5feWFNYXBDb21wb25lbnQuaXNCcm93c2VyKSB7XG4gICAgICBjb25zdCBzdWIgPSB0aGlzLl95YU1hcENvbXBvbmVudC5tYXAkLnN1YnNjcmliZSgobWFwKSA9PiB7XG4gICAgICAgIGlmIChtYXApIHtcbiAgICAgICAgICBjb25zdCBtdWx0aXJvdXRlID0gdGhpcy5fY3JlYXRlTXVsdGlyb3V0ZSgpO1xuICAgICAgICAgIHRoaXMuX211bHRpcm91dGUgPSBtdWx0aXJvdXRlO1xuXG4gICAgICAgICAgbWFwLmdlb09iamVjdHMuYWRkKG11bHRpcm91dGUpO1xuICAgICAgICAgIHRoaXMuX2V2ZW50TWFuYWdlci5zZXRUYXJnZXQobXVsdGlyb3V0ZSk7XG4gICAgICAgICAgdGhpcy5fbmdab25lLnJ1bigoKSA9PiB0aGlzLnJlYWR5LmVtaXQoeyB5bWFwcywgdGFyZ2V0OiBtdWx0aXJvdXRlIH0pKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuX3N1Yi5hZGQoc3ViKTtcbiAgICB9XG4gIH1cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5fbXVsdGlyb3V0ZSkge1xuICAgICAgdGhpcy5feWFNYXBDb21wb25lbnQ/Lm1hcCQudmFsdWU/Lmdlb09iamVjdHMucmVtb3ZlKHRoaXMuX211bHRpcm91dGUpO1xuICAgICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmRlc3Ryb3koKTtcbiAgICB9XG5cbiAgICB0aGlzLl9zdWIudW5zdWJzY3JpYmUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZXN0cnVjdHMgc3RhdGUgYW5kIHBhc3NlcyB0aGVtIGluIEFQSS5cbiAgICogQHBhcmFtIG1vZGVsXG4gICAqIEBwYXJhbSBtdWx0aXJvdXRlXG4gICAqL1xuICBwcml2YXRlIF9zZXRNb2RlbChcbiAgICBtb2RlbDogeW1hcHMuSU11bHRpUm91dGVNb2RlbEpzb24sXG4gICAgbXVsdGlyb3V0ZTogeW1hcHMubXVsdGlSb3V0ZXIuTXVsdGlSb3V0ZSxcbiAgKTogdm9pZCB7XG4gICAgY29uc3QgeyByZWZlcmVuY2VQb2ludHMsIHBhcmFtcyB9ID0gbW9kZWw7XG5cbiAgICBpZiAocmVmZXJlbmNlUG9pbnRzKSB7XG4gICAgICBtdWx0aXJvdXRlLm1vZGVsLnNldFJlZmVyZW5jZVBvaW50cyhyZWZlcmVuY2VQb2ludHMpO1xuICAgIH1cblxuICAgIGlmIChwYXJhbXMpIHtcbiAgICAgIG11bHRpcm91dGUubW9kZWwuc2V0UGFyYW1zKHBhcmFtcyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgTXVsdGlyb3V0ZS5cbiAgICovXG4gIHByaXZhdGUgX2NyZWF0ZU11bHRpcm91dGUoKTogeW1hcHMubXVsdGlSb3V0ZXIuTXVsdGlSb3V0ZSB7XG4gICAgcmV0dXJuIG5ldyB5bWFwcy5tdWx0aVJvdXRlci5NdWx0aVJvdXRlKHRoaXMuX2NvbWJpbmVNb2RlbCgpLCB0aGlzLm9wdGlvbnMpO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbWJpbmVzIHRoZSBtb2RlbCBhbmQgcmVmZXJlbmNlIHBvaW50cyBpbnRvIHNpbmdsZSBvYmplY3RcbiAgICovXG4gIHByaXZhdGUgX2NvbWJpbmVNb2RlbCgpOiB5bWFwcy5JTXVsdGlSb3V0ZU1vZGVsSnNvbiB7XG4gICAgY29uc3QgbW9kZWwgPSAodGhpcy5tb2RlbCB8fCB7fSkgYXMgeW1hcHMuSU11bHRpUm91dGVNb2RlbEpzb247XG5cbiAgICByZXR1cm4ge1xuICAgICAgLi4ubW9kZWwsXG4gICAgICByZWZlcmVuY2VQb2ludHM6IHRoaXMucmVmZXJlbmNlUG9pbnRzIHx8IG1vZGVsLnJlZmVyZW5jZVBvaW50cyxcbiAgICB9O1xuICB9XG59XG4iXX0=